<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Ivan Hanigan - using-r-eml-to-input-large-numbers-of-variables-part-2</title>
    <meta name="author" content="Ivan Hanigan" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/screen.css">
    <link href="http://feeds.feedburner.com/Disentanglethings" rel="alternate" title="RSS" type="application/rss+xml" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.github_v2.js"></script>
  </head>

  <body>


    <div id="header" class="section">
      <div class="wrapper">
        <strong id="blog-title">
          <a href="/" rel="home">Disentangle Things by Ivan Hanigan</a>
        </strong>
        <p id="blog-description"></p>
        <div id="navigation">
          <ul class="nav clearfix">
            <li> <a href="/blog.html">Notes</a></li> 
            <li><a href="/research.html">About</a></li>
            <li><a href="/projects.html">Projects</a></li>
            <li><a href="/cv.html">CV</a></li>
            <li><a href="http://lmgtfy.com/?q=site%3Aivanhanigan.github.io">Search this Site</a></li> 
          </ul>
        </div>
      </div>
    </div>
    <div id="main" class="section">
      <div class="wrapper">
        <div id="content">
          <h2>Welcome to my Open Notebook</h2>
            <!--<li class="first-child"><a href="/research.html">About My Notebook</a></li>-->
            <!--<li><a href="/donors.html">Donors</a></li>-->
            <!-- <li><a href="/projects.html">Data</a></li> -->
            <!--<li><a href="/publications.html">Journal Publications</a></li>-->
<p>This is an Open Notebook with <a href="https://en.wikipedia.org/wiki/Open_notebook_science" target="new">Selected Content - Delayed</a>. Find out more <a href="/research.html">Here</a>.</p>

<p>  <img src="/images/ONS-SCD.png" alt="ONS-SCD.png" /></p>

          <div class="full">
  <h1 class="entry-title">
    <a href="/2014/04/using-r-eml-to-input-large-numbers-of-variables-part-2/" title="using-r-eml-to-input-large-numbers-of-variables-part-2" rel="bookmark">using-r-eml-to-input-large-numbers-of-variables-part-2</a>
  </h1>
  <!-- AddThis Button BEGIN -->
  <div class="addthis_toolbox addthis_default_style ">
    <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    <a class="addthis_button_tweet"></a>
    <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <!-- AddThis Button END -->
  <div class="entry-content full-content">
    <p>In my <a href="/2014/04/using-reml-to-input-large-number-of-column-descriptions">previous post</a> I showed a workaround to input large number of variabels than Morpho could handle.  I have found out an interesting thing about the R EML package data.set approach.  The unit.defs depends on the type of the column in the data frame (R knows if you try to trick it).  Rather than describe all the levels of the factor vars, I wanted to just have simple descriptions for numeric or character type columns.  If numeric it should be number and if character it can be the name of the column.  Because I am just trying to sidestep the issue with morpho failing to input the 200 plus variables I just need to create a dataframe with either number or character (not factor).</p>

<p>For an example:</p>

<h4>R Code:</h4>

<pre><code>require(EML)
fname &lt;- dir("myData", full.names=T, pattern = 'csv')
fname
fname  &lt;- "myData/paper_data.csv"  
dat  &lt;- read.csv(fname, stringsAsFactor=F)
# the variable names include special characters such as % and [ so need to do some extra work
names_dat  &lt;- read.csv(fname, nrow=1, header=F, stringsAsFactor=F)
names(dat) &lt;- names_dat
head(dat)
nrow(dat)
# the first 46 variables are nominal, thereafter they are all numeric
str(dat[,1:46])
str(dat[,47:49])
# but these numerics are character for some reason
table(dat[ , 47])
# it is because the raw data had * instead of NA...  I could use na.strings when I call read.table above, or deal with it here
# I'll just convert them to numerics now
dat1 &lt;- dat[,1:46]
dat2 &lt;- dat[,47:ncol(dat)]
dat2[dat2 == "*"] &lt;- NA
for(i in 1:ncol(dat2)){
  dat2[,i]  &lt;- as.numeric(dat2[ , i])
}
str(dat2)
# good that has set them up properly, also make sure all the text are character type
for(i in 1:ncol(dat1)){
  dat1[,i]  &lt;- as.character(dat1[ , i])
}
# recombine
dat &lt;- cbind(dat1,dat2)
str(dat)
# then I add to it the definition for the constructed variables
unit_defs &lt;- list()
for(i in 1:46){
    unit_defs[[i]] &lt;- names(dat[i])
}
for(i in 47:ncol(dat)){
    unit_defs[[i]] &lt;- "number"
}
unit_defs[1:20]
col_defs &lt;- names(dat)
col_defs
#names(dat)
dat &lt;- data.set(dat,
               col.defs = col_defs,
               unit.defs = unit_defs
               )
str(dat)

eml_config(creator="Ivan Charles Hanigan &lt;ivan.hanigan@gmail.com&gt;")
dir()
oldwd &lt;- getwd()
setwd("myData")
eml_write(dat, file = "test_eml.xml", title = "test_eml")
setwd(oldwd)
</code></pre>

<p></p>


<h3>Use Morpho to tidy up the Results</h3>

<ul>
<li>The result can be imported to Morpho and then edited from there</li>
<li>or you can use a code editor like emacs or notepad++ to do bulk find-and-replace operations to fix up issues</li>
</ul>


<h3>Conclusions</h3>

<ul>
<li>Morpho failed with 200 plus variables</li>
<li>the R EML package succeeded to write the file</li>
<li>I needed to pay careful attention to the type of the variables in the data.frame before running the R EML functions</li>
</ul>


    <div class="clear"></div>
  </div>
  <!-- AddThis Button BEGIN -->
  <div class="addthis_toolbox addthis_default_style ">
    <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    <a class="addthis_button_tweet"></a>
    <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <!-- AddThis Button END -->
  <p class="alt-font tight">
    Posted in&nbsp;
    
    <a href="/categories/data documentation" title="data documentation" rel="category tag">data documentation</a>
    
  </p>
  <p class="by-line">
    <span class="date full-date">
      <abbr class="published" title="2014-04-29 00:00:00 +1000">29 Apr 2014</abbr>
    </span>
  </p>
  <div class="clear"></div>
</div>
<div class="rule">
  <hr/>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'disentanglethings'; // required: replace example with your forum shortname

    var disqus_url = "http://ivanhanigan.github.com/2014/04/using-r-eml-to-input-large-numbers-of-variables-part-2/";

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

        </div>
        <div id="sidebar">
          <div id="carrington-subscribe" class="widget">
            <h2 class="widget-title">Subscribe</h2>
            <a class="feed alignright" title="RSS 2.0 feed for posts" rel="alternate" href="http://feeds.feedburner.com/Disentanglethings">
              <img src="/images/rss-button.gif" alt="latest posts" title="latest posts">
            </a>
          </div>
          <div id="carrington-about" class="widget">
            <div class="about">
              <h2 class="widget-title">About</h2>
              <p>I am a PhD Student at the Australian National University.</p>
              <a class="more" href="/about.html">more â†’</a>

            </div>
          </div>
<div class="sidebar">
  <div class="logos">
  
  <ul>
          
      <!-- Add in logos here -->
      <a href="http://scholar.google.com/citations?user=cGN1P0wAAAAJ&hl=en"><img src="/images/GSIcon.jpg" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="http://orcid.org/0000-0002-6360-6793"><img src="/images/ORCID.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="http://github.com/ivanhanigan"><img src="/images/github.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="mailto:ivan.hanigan@gmail.com"><img src="/images/gmail.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="https://twitter.com/ivanhanigan"><img src="/images/twitter.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="http://www.linkedin.com/profile/view?id=AAMAAA-0wtwBnL35hDkq1UdK6vesju0LRODIVk0&trk=hp-identity-name"><img src="/images/linkedin.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
    
  </ul>
   
  </div>
</div>
          <!--
          	<p>
              <a href="http://ropensci.org/">
                <img src="/images/ropensci.png">
              </a>
        	</p>
			-->
			<!--
          <div id="carrington-link" class="widget">
          	<a href="http://ropensci.org/">
            <img src="/images/ropensci.png">
          </div>
          	-->
          
          <div id="primary-sidebar">
            <div class="widget">
              <h2 class="widget-title">Recent Entries</h2>
              <ul>
                
                <li>
                  <a href="/2015/12/this-is-an-open-notebook-but-selected-content-delayed/" title="This is an open notebook but selected content delayed" rel="bookmark">This is an open notebook but selected content delayed</a>
                </li>
                
                <li>
                  <a href="/2015/12/using-scholar-rankings-to-provide-weights-in-systematic-literature-reviews-part-1/" title="Using scholar rankings to provide weights in systematic literature reviews part 1" rel="bookmark">Using scholar rankings to provide weights in systematic literature reviews part 1</a>
                </li>
                
                <li>
                  <a href="/2015/12/my-project-inventory/" title="My project inventory" rel="bookmark">My project inventory</a>
                </li>
                
                <li>
                  <a href="/2015/12/show-missingness-in-large-dataframes-with-ggplot-thanks-to-r-blogger/" title="show-missingness-in-large-dataframes-with-ggplot-thanks-to-r-blogger" rel="bookmark">show-missingness-in-large-dataframes-with-ggplot-thanks-to-r-blogger</a>
                </li>
                
                <li>
                  <a href="/2015/11/notes-from-dr-climate-re-data-reference-syntax-models-for-file-organisation-and-naming/" title="Notes from Dr Climate Re data reference syntax models for file organisation and naming" rel="bookmark">Notes from Dr Climate Re data reference syntax models for file organisation and naming</a>
                </li>
                
              </ul>
              <h2 class="widget-title">Categories</h2>
              <ul>
<!-- <li> -->
<!--               <a class="workflow" href="/categories/workflow.html">workflow</a> -->
<!-- </li> -->
                
                <li><a href="/categories/overview">overview (7)</a></li>
                
                <li><a href="/categories/research methods">research methods (42)</a></li>
                
                <li><a href="/categories/disentangle things">disentangle things (4)</a></li>
                
                <li><a href="/categories/spatial">spatial (7)</a></li>
                
                <li><a href="/categories/extreme weather events">extreme weather events (11)</a></li>
                
                <li><a href="/categories/spatial dependence">spatial dependence (9)</a></li>
                
                <li><a href="/categories/data documentation">data documentation (32)</a></li>
                
                <li><a href="/categories/awap grids">awap grids (1)</a></li>
                
                <li><a href="/categories/cloud building">cloud building (2)</a></li>
                
                <li><a href="/categories/disentangle">disentangle (41)</a></li>
                
                <li><a href="/categories/project management">project management (3)</a></li>
                
                <li><a href="/categories/e-collaboration">e-collaboration (1)</a></li>
                
                <li><a href="/categories/ecosocial tipping points">ecosocial tipping points (2)</a></li>
                
                <li><a href="/categories/drought">drought (1)</a></li>
                
                <li><a href="/categories/morpho">morpho (1)</a></li>
                
                <li><a href="/categories/reproducible research reports">reproducible research reports (3)</a></li>
                
                <li><a href="/categories/data management">data management (2)</a></li>
                
                <li><a href="/categories/data operation">data operation (1)</a></li>
                
                <li><a href="/categories/workflow tools">workflow tools (3)</a></li>
                
                <li><a href="/categories/exploratory data analysis">exploratory data analysis (2)</a></li>
                
                <li><a href="/categories/statistical modelling">statistical modelling (1)</a></li>
                
                <li><a href="/categories/blog home">blog home (1)</a></li>
                
              </ul>
              <h2 class="widget-title">Entries grouped by Tags</h2>
              <ul>
                
                <li><a href="/tag/morpho">morpho (15)</a></li>
                
                <li><a href="/tag/project management">project management (3)</a></li>
                
                <li><a href="/tag/Data Management System">Data Management System (3)</a></li>
                
                <li><a href="/tag/R-eml">R-eml (3)</a></li>
                
                <li><a href="/tag/bugs">bugs (1)</a></li>
                
                <li><a href="/tag/software">software (3)</a></li>
                
                <li><a href="/tag/writing">writing (2)</a></li>
                
                <li><a href="/tag/spatial">spatial (1)</a></li>
                
                <li><a href="/tag/diagrams">diagrams (3)</a></li>
                
                <li><a href="/tag/blogging">blogging (2)</a></li>
                
                <li><a href="/tag/metadata">metadata (1)</a></li>
                
                <li><a href="/tag/R">R (1)</a></li>
                
                <li><a href="/tag/Reproducible Research Reports">Reproducible Research Reports (2)</a></li>
                
                <li><a href="/tag/Data Management">Data Management (3)</a></li>
                
                <li><a href="/tag/Exploratory Data Analysis">Exploratory Data Analysis (1)</a></li>
                
                <li><a href="/tag/bibliometrics and literature reviewing">bibliometrics and literature reviewing (2)</a></li>
                
                <li><a href="/tag/workflow tools">workflow tools (1)</a></li>
                
                <li><a href="/tag/data management">data management (1)</a></li>
                
                <li><a href="/tag/exploratory data analysis">exploratory data analysis (1)</a></li>
                
              <div class="clear"></div>
              </ul>
            </div>
          </div>
          <!-- <div id="secondary-sidebar"> -->
          <!--   <div class="widget"> -->
          <!--     <h2 class="widget-title">Tags</h2> -->
          <!--     <ul> -->
          <!--        -->
          <!--       <li><a href="/tag/morpho">morpho (15)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/project management">project management (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/Data Management System">Data Management System (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/R-eml">R-eml (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/bugs">bugs (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/software">software (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/writing">writing (2)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/spatial">spatial (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/diagrams">diagrams (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/blogging">blogging (2)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/metadata">metadata (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/R">R (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/Reproducible Research Reports">Reproducible Research Reports (2)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/Data Management">Data Management (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/Exploratory Data Analysis">Exploratory Data Analysis (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/bibliometrics and literature reviewing">bibliometrics and literature reviewing (2)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/workflow tools">workflow tools (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/data management">data management (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/exploratory data analysis">exploratory data analysis (1)</a></li> -->
          <!--        -->
          <!--     <div class="clear"></div> -->
          <!--     </ul> -->
          <!--   </div> -->
            <!--
            <div class="widget">
              <h2 class="widget-title">Archives</h2>
              <ul>
                
              </ul>
              <div class="clear"></div>
            </div>
            -->
          </div>
        </div>
      </div>
    </div>
    <div id="footer" class="section">
      <div class="wrapper">
        <a id="generator-link">
          Banner Artwork by Cindy Hales. Site powered by
          <a href="https://github.com/mojombo/jekyll" rel="generator">Jekyll</a>
          with
          <a href="http://carringtontheme.com" title="Carrington theme for WordPress">Carrington</a>
          theme.
      </div>
      <div id="developer-link">
      </div>
    </div>
    <!--
	<a href="http://github.com/SChamberlain"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://assets2.github.com/img/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf?repo=&url=http%3A%2F%2Fs3.amazonaws.com%2Fgithub%2Fribbons%2Fforkme_right_red_aa0000.png&path=" alt="Fork me on GitHub"></a>
	-->
    <script type="text/javascript">
      var disqus_shortname = 'disentanglethings';

      (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
    </script>
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-28059658-1");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </body>
</html>
