--- 
name: adjust-branch-lengths-with-node-ages-comparison-of-two-methods
layout: post
title: "Adjust branch lengths with node ages: comparison of two methods"
date: 2011-04-10 13:02:00.003000 -05:00
categories: 
- phylocom
- Methods
- Evolution
- Phylogenetics
- R
---
Here is an approach for comparing two methods of adjusting branch lengths on trees: bladj in the program Phylocom and a fxn written by Gene Hunt at the Smithsonian.<br /><br />Get the code and example files (tree and node ages) <a href="https://gist.github.com/938313">here</a><br />Get phylocom here:&nbsp;<a href="http://www.phylodiversity.net/phylocom/">http://www.phylodiversity.net/phylocom/</a><br /><br />Gene Hunt's method has many options you can mess with, including setting tip ages (not available in bladj), setting node ages, and minimum branch length imposed. You will notice that Gene's method may be not the appropriate if you only have extant taxa.<br /><br />The function AdjBrLens uses as input a newick tree file and a text file of node ages, and uses functions you can simply run by "source" the R file bladjing_twomethods.R file from <a href="https://gist.github.com/938313">here</a>.<br /><br />Note that blad does not like numbers for node names, so you have to put a character in front of a number of just character names for nodes.<br /><br /><br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><span style="color: #666666; font-style: italic;"># This is where the work happens... </span><br /><span style="color: #666666; font-style: italic;"># Directory below needs to have at least three items:</span><br /><span style="color: #666666; font-style: italic;">#  1. phylocom executable for windows or mac</span><br /><span style="color: #666666; font-style: italic;">#  2. tree newick file</span><br /><span style="color: #666666; font-style: italic;">#  3. node ages file as required by phylocom, see their manual</span><br /><span style="color: #666666; font-style: italic;"># Output: trees_out is a list of three trees, the original, bladj, and Gene Hunt's method</span><br /><span style="color: #666666; font-style: italic;"># Also, within the function all three trees are written to file as PDFs</span><br /><a href="http://inside-r.org/r-doc/base/setwd"><span style="color: #003399; font-weight: bold;">setwd</span></a><span style="color: #009900;">(</span><span style="color: blue;">"/Mac/R_stuff/Blog_etc/Bladjing"</span><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># set working directory</span><br /><a href="http://inside-r.org/r-doc/base/source"><span style="color: #003399; font-weight: bold;">source</span></a><span style="color: #009900;">(</span><span style="color: blue;">"bladjing_twomethods.R"</span><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># run functions from source file</span><br />trees_out &lt;- AdjBrLens<span style="color: #009900;">(</span><span style="color: blue;">"tree.txt"</span><span style="color: #339933;">,</span> <span style="color: blue;">"nodeages.txt"</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># plot trees of three methods together, </span><br /><span style="color: #666666; font-style: italic;"># with nodes with age estimates labeled</span><br /><a href="http://inside-r.org/r-doc/grDevices/jpeg"><span style="color: #003399; font-weight: bold;">jpeg</span></a><span style="color: #009900;">(</span><span style="color: blue;">"threeplots.jpeg"</span><span style="color: #339933;">,</span> quality=<span style="color: #cc66cc;">100</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/graphics/layout"><span style="color: #003399; font-weight: bold;">layout</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/matrix"><span style="color: #003399; font-weight: bold;">matrix</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">3</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399; font-weight: bold;">plot</span></a><span style="color: #009900;">(</span>trees_out<span style="color: #009900;">[</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />nodelabels<span style="color: #009900;">(</span>trees_out<span style="color: #009900;">[</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span>$node.label<span style="color: #339933;">,</span> cex = <span style="color: #cc66cc;">0.6</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/graphics/title"><span style="color: #003399; font-weight: bold;">title</span></a><span style="color: #009900;">(</span><span style="color: blue;">"original tree"</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399; font-weight: bold;">plot</span></a><span style="color: #009900;">(</span>trees_out<span style="color: #009900;">[</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />nodelabels<span style="color: #009900;">(</span>trees_out<span style="color: #009900;">[</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span>$node.label<span style="color: #339933;">,</span> cex = <span style="color: #cc66cc;">0.6</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/graphics/title"><span style="color: #003399; font-weight: bold;">title</span></a><span style="color: #009900;">(</span><span style="color: blue;">"bladj method"</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399; font-weight: bold;">plot</span></a><span style="color: #009900;">(</span>trees_out<span style="color: #009900;">[</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />nodelabels<span style="color: #009900;">(</span>trees_out<span style="color: #009900;">[</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span>$node.label<span style="color: #339933;">,</span> cex = <span style="color: #cc66cc;">0.6</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/graphics/title"><span style="color: #003399; font-weight: bold;">title</span></a><span style="color: #009900;">(</span><span style="color: blue;">"gene hunt method, scalePhylo"</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/grDevices/dev.off"><span style="color: #003399; font-weight: bold;">dev.off</span></a><span style="color: #009900;">(</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><br />It is sort of hard to see the differences in&nbsp;the branch length changes here, but the individual output trees will reveal the differences better.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-tLK1y12TYlI/TaHwayCs3GI/AAAAAAAAEbU/rPsFYqSEDuI/s1600/threeplots.jpeg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-tLK1y12TYlI/TaHwayCs3GI/AAAAAAAAEbU/rPsFYqSEDuI/s1600/threeplots.jpeg" /></a></div>
