<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Ivan Hanigan - Disentangle Things</title>
    <meta name="author" content="Ivan Hanigan" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/screen.css">
    <link href="http://feeds.feedburner.com/Disentanglethings" rel="alternate" title="RSS" type="application/rss+xml" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.github_v2.js"></script>
  </head>

  <body>


    <div id="header" class="section">
      <div class="wrapper">
        <strong id="blog-title">
          <a href="/" rel="home">Disentangle Things by Ivan Hanigan</a>
        </strong>
        <p id="blog-description"></p>
        <div id="navigation">
          <ul class="nav clearfix">
            <li class="first-child"><a href="/research.html">About My Notebook</a></li>
            <li> <a href="/blog.html">Entries</a></li> 

            <li><a href="/about.html">About Me</a></li>
            <li><a href="/publications.html">Journal Publications</a></li>
            <li><a href="/projects.html">Software</a></li>
            <li><a href="/projects.html">Data</a></li>
            <li><a href="/cv.html">My CV</a></li>
            <li><a href="http://lmgtfy.com/?q=site%3Aivanhanigan.github.io">Search this Site</a></li> 
            <!--<li><a href="/donors.html">Donors</a></li>-->
          </ul>
        </div>
      </div>
    </div>
    <div id="main" class="section">
      <div class="wrapper">
        <div id="content">
          <h2>Welcome to my Open Notebook</h2>

<p>This is an Open Notebook with <a href="http://onsclaims.wikispaces.com/">Selected Content - Delayed</a>. Find out more <a href="/research.html">Here</a>.</p>

<p>  <img src="/images/ONS-SCD.png" alt="ONS-SCD.png" /></p>

          <!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
  <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
  <a class="addthis_button_tweet"></a>
  <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
  <a class="addthis_counter addthis_pill_style"></a>
</div>
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=SChamberlain"></script>
<!-- AddThis Button END -->

  <div class="full">
    <h1 class="entry-title">
      <a href="/2013/11/climatic-drought-guestpost-by-luciana-porfirio/" title="climatic-drought-guestpost-by-luciana-porfirio" rel="bookmark">climatic-drought-guestpost-by-luciana-porfirio</a>
    </h1>
    <div class="entry-content full-content">
      <h3>Guest post by Luciana Porfirio with code contributions by Francis Markham</h3>

<ul>
<li>Recently I encountered a student doing an analysis who was doing everything in excel, and I couldn't contain my mouth and say R would be better... but it isn't a simple task. So any here are some tips.</li>
<li>There is a table with 62 years * 12 months of rain data in mm. We calculated the cumulative distribution using ecdf: empirical cumulative distribution function. So the table looks like this: Year Jan Feb Mach (...) each cell contains the cum dist.</li>
<li>We also got the number of months per year with less than X mm of rain. But he needs to know how many months  are between the drought months, regardless the year. So, I thought that converting the data into a ts was going to facilitate the task, but it doesn't, because now I don't' have columns and rows any longer.</li>
<li>But I struggled to handle a ts object to do for example an ifelse.</li>
<li>Luckily there are many many tricks about R, and with the code below we solved all his problems (and many months of work in excel).</li>
<li><a href="/data/raj_rain_data.csv">Get the example data here</a></li>
<li>This is how it looks like:</li>
</ul>


<h4>R Code:</h4>

<pre><code>###############################################
require(reshape2)

###############################################
#read csv file with rain BoM data
dat = read.csv('raj_rain_data.csv')

fn &lt;- apply(dat[,2:13], 2, ecdf) # equivalent to Excel's percentrank function, only for cols 2 to 13 but you need to apply the function to each month

#this fun does all the months at once
fn2 = data.frame(t(do.call("rbind", sapply(1:12, FUN = function(i) fn[[i]](dat[,i+1]), simplify = FALSE))))
colnames(fn2) = colnames(dat[,2:13])
fn2$year = dat$Year

#if the value is lower than 0.4, retrieves a 1, otherwise 0
fn2$drought = rowSums(ifelse(apply(fn2[,1:12], 2, FUN= function (x) x &lt; 0.4)==TRUE, 1,0))

#if the value is lower than 0.1, retrieves a 1, otherwise 0
fn2$extreme = rowSums(ifelse(apply(fn2[,1:12], 2, FUN= function (x) x &lt; 0.1)==TRUE, 1,0))

str(fn2)
names(fn2)

#ts didn't work - Francis suggested to melt the data.frame # Melt
#fn2 to tall data set
fn2.tall &lt;- melt(fn2, id.vars="year")

# Get the year-month into date format
fn2.tall$date &lt;- with(fn2.tall,
                             as.Date(paste("1", variable, year), "%d %b %Y"))

# Convert dates into months since 0 BC/AD (arbitrary, but doesn't
# matter)
#I'm not using the month.idx with Ivan's solution (remove)
fn2.tall$mnth.idx &lt;- sapply(fn2.tall$date, function(x){
  12*as.integer(format(x, "%Y")) + (as.integer(format(x, "%m")) - 1)
})

# Sort by date
fn2.tall &lt;- fn2.tall[order(fn2.tall$date),]


#Ivan's solution

x&lt;-fn2.tall$value&lt;0.4
xx &lt;- (cumsum(!x) + 1) * x
x2&lt;-(seq_along(x) - match(xx, xx) + 1) * x
fn2.tall$count&lt;-x2

#counts the number of cases of drought
as.data.frame(table(fn2.tall$count))
###############################################
###############################################
</code></pre>

      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/extreme weather events" title="extreme weather events" rel="category tag">extreme weather events</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2013/11/climatic-drought-guestpost-by-luciana-porfirio/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2013-11-01 00:00:00 +1100">01 Nov 2013</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full">
    <h1 class="entry-title">
      <a href="/2013/10/quantum-gis-visualisations/" title="quantum-gis-visualisations" rel="bookmark">quantum-gis-visualisations</a>
    </h1>
    <div class="entry-content full-content">
      <ul>
<li>This is a quick post on Quantum GIS for spatial data visualisation</li>
<li>it is also a follow up on <a href="http://swish-climate-impact-assessment.github.io/2013/06/test-gislibrary/">this post about area concordance</a></li>
<li>Quantum GIS is getting pretty good but is still a bit tricky to make good looking maps</li>
<li>QGIS can use <a href="http://swish-climate-impact-assessment.github.io/2013/04/quantumgis-and-postgis/">remote PostGIS geodatabases on the Cloud as the backend</a></li>
</ul>


<h4>R Code: use postgis to create area-concordance</h4>

<pre><code>require(devtools)
install_github("gisviz", "ivanhanigan")
require(gisviz)
require(swishdbtools)
ch &lt;- connect2postgres2("gislibrary")
# make a temporary tablename, to avoid clobbering
temp_table &lt;- swish_temptable("gislibrary")
temp_table &lt;- paste("public", temp_table$table, sep = ".")
temp_table
# this is going to be public.foo11c7673416ea

sql &lt;- postgis_concordance(conn = ch, source_table = "abs_sla.nswsla91",
   source_zones_code = 'sla_id', target_table = "abs_sla.nswsla01",
   target_zones_code = "sla_code",
   into = temp_table, tolerance = 0.01,
   subset_target_table = "cast(sla_code as text) like '105%'", 
   eval = F) 
cat(sql)
dbSendQuery(ch, sql)
</code></pre>

<p></p>


<ul>
<li>now connect to PostGIS using QGIS <a href="http://swish-climate-impact-assessment.github.io/2013/04/quantumgis-and-postgis/">as described in this tute</a></li>
<li>and add the layer to the map</li>
<li>Style it how you like, I also added NSWSLA1991 over the top</li>
<li>go into the "new print composer"</li>
</ul>


<p><img src="/images/qgis-new-print-composer.png" alt="qgis-new-print-composer.png" /></p>

<p><img src="/images/qgis-add-new-map.png" alt="qgis-add-new-map.png" /></p>

<h3>Results</h3>

<ul>
<li>hit the export to image and viola</li>
</ul>


<p><img src="/images/qgis-export-image.png" alt="qgis-export-image.png" /></p>

<h3>Don't forget to clean up the database!</h3>

<h4>R Code:</h4>

<pre><code>dbSendQuery(ch, sprintf("drop table %s", temp_table))
</code></pre>

      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/spatial" title="spatial" rel="category tag">spatial</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2013/10/quantum-gis-visualisations/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2013-10-31 00:00:00 +1100">31 Oct 2013</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full">
    <h1 class="entry-title">
      <a href="/2013/10/notes-on-spatial-stats-meeting-with-sarunya-sujaritpong/" title="notes-on-spatial-stats-meeting-with-sarunya-sujaritpong" rel="bookmark">notes-on-spatial-stats-meeting-with-sarunya-sujaritpong</a>
    </h1>
    <div class="entry-content full-content">
      <ul>
<li>Yesterday I met with Sarunya Sujaritpong a PhD student working with <a href="http://ivanhanigan.github.io/2013/10/spatially-structured-time-series-with-nmmaps/">spatially structured time-series models as described previously</a></li>
<li>Her supervisor Keith Dear has given me a lot of good stats advice in the past and one bit I keep thinking about is that a time series model can be fit for multiple spatial areal units of the same city and residual spatial auto-correlation in the errors should not be too much of a concern</li>
<li>The problem would be if you get strong spatial autocorrelation of the residuals this indicates that the assumption of independent errors is violated and you will have tighter confidence intervals around the coefficients of interest than is really the case, inflating the signficance estimated for the relative risk</li>
<li>The beta coefficient itself shouldn't be affected.</li>
<li>So long as biostatisticians like Keith are comfortable with not addressing this issue in spatially structured time-series that is great but I see people are <a href="http://www.plosone.org/article/info%3Adoi%2F10.1371%2Fjournal.pone.0043360">starting to include this in their models</a></li>
<li>To date I've mostly seen it done in spatial (cross sectional) data analysis, not spatial times-series</li>
<li>I'm preparing for the day when I might need to address this for a reviewer and would like to know what to do about it in case that happens</li>
<li>So I asked Sarunya for a discussion about her research</li>
</ul>


<h3>Sarunya's model is essentially like this</h3>

<h4>R Code:</h4>

<pre><code>fit &lt;- glm(deaths ~ pollutant1 + pollutant2 + pollutant ... +
       ns(temp, df) + ns(humidity, df) +
       ns(time, df = 7*numYears) +
       SLA * ns(time, df = 2),
       data = analyte, family = poisson
       )
</code></pre>

<p></p>


<ul>
<li>SLA is Statistical Local Area (now called SA2, like a suburb)</li>
<li>Sarunya explained that the research question was if the magnitude of the coeff on pollutant1 differed between this model and the old style of model where an entire city is used as the unit of analysis per day and exposure estimates are calculated as averages across several monitoring stations in the city</li>
<li>turns out that this comparison is still valid EVEN IF THE STANDARD ERROR IS BIASED DUE TO RESIDUAL SPATIAL AUTOCORRELATION</li>
<li>therefore this study avoids the issue by it's intentional design to compare betas not se</li>
<li>Interestingly Sarunya explained that the stats theory suggests that even if the exposure precision is increased (exposure misclassification bias is decreased) the se on the beta will not be affected.</li>
<li>this is fascinating in itself, but a separate issue for another post</li>
</ul>


<h3>Conclusions</h3>

<ul>
<li>So it looks like the extent a study might need to consider the issue of potential residual spatial autocorrelation depends alot on what questions are being asked and what inferences will be attempted from the results</li>
<li>if the aim of the study is to estimate the magnitude AND CONFIDENCE INTERVALS of an exposure's relative risk (especially some novel exposure such as interstellar space dust across the suburbs) then the issue might become important to address.</li>
</ul>


<p>THANKS Sarunya!</p>

      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/spatial dependence" title="spatial dependence" rel="category tag">spatial dependence</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2013/10/notes-on-spatial-stats-meeting-with-sarunya-sujaritpong/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2013-10-31 00:00:00 +1100">31 Oct 2013</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full">
    <h1 class="entry-title">
      <a href="/2013/10/if-disease-incidence-varies-with-age-control-for-it/" title="if-disease-incidence-varies-with-age-control-for-it" rel="bookmark">if-disease-incidence-varies-with-age-control-for-it</a>
    </h1>
    <div class="entry-content full-content">
      <ul>
<li>today I was in a meeting where the discussion turned to maps of crude incidence rates, age-standardised rates and regression models controlling for age</li>
<li>If disease incidence does not vary with age then there is not much point in controlling for this,</li>
<li>apart from the work done in exploratory data analysis to ascertain whether or not this is the case</li>
<li>I proposed that if you've done all the work on age-specific rates needed to test if incidence varies with age, then you might as well present age adjusted rates seeing as you've already done the work anyway</li>
</ul>


<h3>An example</h3>

<ul>
<li>The project is highly confidential due to the nature of the data</li>
<li>We;ll call the study location South Kingsland to protect the identity</li>
</ul>


<h4>R Code:</h4>

<pre><code># get spatial data
require(swishdbtools) # github package, under
                      # swish-climate-impact-assessment

Tab1 &lt;- read.csv("data/dataset.csv", sep= ",", header = TRUE, stringsAsFactor = F)
Tab1 &lt;- as.data.frame(table(Tab1$SLA))
nrow(Tab1)
write.csv(Tab1, "data/SLA.csv", row.names = F)
load2postgres("data/SLA.csv", schema="ivan_hanigan", tablename="sla", ip = "brawn.anu.edu.au",
              db = "gislibrary", pguser = "ivan_hanigan", printcopy = F)


ch  &lt;- connect2postgres2("gislibrary")
sql_subset(ch, "ivan_hanigan.sla", eval = T, limit = 10)


sql_subset(ch, "abs_sla.qldsla01", select =  "sla_name, st_y(st_centroid(geom))", eval = T, limit = 10)
dbSendQuery(ch,
  "select sla_name, geom
  into southkingsland
  from abs_sla.qldsla01 t1
  join
  sla t2
  on t1.sla_name = t2.var1;
  alter table southkingsland add column gid serial primary key;
  ")
# these are missing from spatial data
## 42                      West End                          &lt;NA&gt;
## 43                OVERSEAS-OTHER                          &lt;NA&gt;
## 44                  Yarrabah (S)                          &lt;NA&gt;
## 45     Rowes Bay-Belgian gardens                          &lt;NA&gt;
</code></pre>

<p></p>


<h3>visualise with QGIS</h3>

<p><img src="/images/southkingsland.png" alt="southkingsland.png" /></p>

<h4>R Code:</h4>

<pre><code># func
require(plyr)

# load
Tab2 &lt;- read.csv("data/dataset.csv", sep= ",", header = TRUE, stringsAsFactor = F)
names(Tab2)
# [1] "SLA"       "agegrp"    "Sex"       "district"  "dm"        "ninf"     
# [7] "popSLA"    "Month"     "Year"      "groupyear"
test_sla  &lt;- names(table(Tab2$SLA)[1])
subset(Tab2, SLA == test_sla &amp; Year == 2001 &amp; agegrp == 1 &amp; Sex == "MALE")
subset(Tab2, SLA == test_sla &amp; Year == 2001 &amp; agegrp == 1 &amp; Sex == "FEMALE")

# clean
summary(Tab2)
## remove any SLA with NA populations
Tab2 &lt;- Tab2[which(!is.na(Tab2$popSLA)),]     

# do
## first total cases by annualised pop
analyte  &lt;- ddply(Tab2, c("SLA", "Year", "agegrp", "Sex"), summarise,
                  ninf=sum(ninf),
                  popSLA=mean(popSLA)
                  )
#str(analyte)

#subset(analyte, SLA == test_sla)
subset(analyte, SLA == test_sla &amp; Year == 2001 &amp; agegrp == 1)

## now annual totals for study region
analyte2  &lt;- ddply(analyte, c("Year", "agegrp"), summarise,
                  ninf=sum(ninf),
                  popSLA=sum(popSLA)
                  )
str(analyte2)

qc &lt;- subset(analyte2,  Year == 2001)
qc
sum(qc$popSLA)

## now totals
qc  &lt;- ddply(analyte2, c("Year"), summarise,
             ninf=sum(ninf),
             popSLA=sum(popSLA)
             )
qc
sum(qc$ninf)
mean(qc$popSLA)

## totals by age
subset(analyte2,  agegrp == 1)
analyte3  &lt;- ddply(analyte2, c("agegrp"), summarise,
                  ninf=sum(ninf),
                  popSLA=mean(popSLA)
                  )
analyte3
sum(analyte3$popSLA)
analyte3$asr  &lt;- (analyte3$ninf / analyte3$popSLA) * 1000
analyte3

png("graphs/south-kingsland-age-specific-rates.png") 
mp &lt;- barplot(analyte3$asr, names.arg = analyte3$agegrp)
box()
dev.off()
</code></pre>

<p></p>


<h3>Plot Age Specific Rates</h3>

<p>Great so with that bit of work we should have an idea of the variation of incidence by age</p>

<p><img src="/images/south-kingsland-age-specific-rates.png" alt="south-kingsland-age-specific-rates.png" /></p>

<h1>Results and Discussion</h1>

<ul>
<li>It looks like the incidence does vary with age</li>
<li>TODO make graphs per year (the scale of the above graph is wrong - decades in the numerator but annualised pops in the denominator)</li>
<li>TODO make graphs by city, by sex</li>
<li>age-standardised rates probably need different age categories, only 4 or 5?</li>
<li>worth commenting on the liklihood that age is not important for time-series models at the city scale, unless age structure changes substantially over time (this is an analysis for the spatial pattern only)</li>
</ul>


<h4>Clean up database!</h4>

<pre><code>dbSendQuery(ch, "drop table sla")
dbSendQuery(ch, "drop table southkingsland")
</code></pre>

      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/research methods" title="research methods" rel="category tag">research methods</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2013/10/if-disease-incidence-varies-with-age-control-for-it/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2013-10-31 00:00:00 +1100">31 Oct 2013</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full">
    <h1 class="entry-title">
      <a href="/2013/10/morpho-and-reml-streamline-the-process-of-metadata-entry/" title="morpho-and-reml-boilerplate-streamline-the-process-of-metadata-entry" rel="bookmark">morpho-and-reml-boilerplate-streamline-the-process-of-metadata-entry</a>
    </h1>
    <div class="entry-content full-content">
      <p><body></p>

<div id="preamble">

</div>




<div id="content">
<h1 class="title">Disentangle Things</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 morpho-and-reml-boilerplate-streamline-the-process-of-metadata-entry</a>
<ul>
<li><a href="#sec-1-1">1.1 Background</a></li>
<li><a href="#sec-1-2">1.2 Speed and Rigour</a></li>
<li><a href="#sec-1-3">1.3 Analysts can often trade-off completeness of documentation for speed</a></li>
<li><a href="#sec-1-4">1.4 Librarians produce gold plated documentation and can take longer to produce this</a></li>
<li><a href="#sec-1-5">1.5 An example</a></li>
<li><a href="#sec-1-6">1.6 Embracing Inaccuracy and Incompleteness</a></li>
<li><a href="#sec-1-7">1.7 Aim</a></li>
<li><a href="#sec-1-8">1.8 Step 1: load a simple example dataset</a></li>
<li><a href="#sec-1-9">1.9 Step 2 create a function to deliver the minimal metadata object</a></li>
<li><a href="#sec-1-10">1.10 reml<sub>boilerplate</sub>-code</a></li>
<li><a href="#sec-1-11">1.11 reml<sub>boilerplate</sub>-test-code</a></li>
<li><a href="#sec-1-12">1.12 Results: This loads into Morpho with some errors</a></li>
<li><a href="#sec-1-13">1.13 Conclusions</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-3">
<h3 id="sec-1"><span class="section-number-3">1</span> morpho-and-reml-boilerplate-streamline-the-process-of-metadata-entry</h3>
<div class="outline-text-3" id="text-1">


</div>

<div id="outline-container-1-1" class="outline-4">
<h4 id="sec-1-1"><span class="section-number-4">1.1</span> Background</h4>
<div class="outline-text-4" id="text-1-1">


<ul>
<li>The Morpho/Metacat system is great for a data repository
</li>
<li>Morpho also claims to be suitable for Ecologists to document their data
</li>
<li>But in my experience it leaves a little to be desired in ease of use for both purposes
</li>
<li>Specifically the speed that documentation can be entered into Morpho is slow
</li>
<li>This post is a first attempt to create some boilerplate code to quickly generate EML metadata using REML.
</li>
</ul>


</div>

</div>

<div id="outline-container-1-2" class="outline-4">
<h4 id="sec-1-2"><span class="section-number-4">1.2</span> Speed and Rigour</h4>
<div class="outline-text-4" id="text-1-2">

<p>As I noted in a previous post, there are [two types of data documentation workflow](<a href="http://ivanhanigan.github.io/2013/10/two-main-types-of-data-documentation-workflow/">http://ivanhanigan.github.io/2013/10/two-main-types-of-data-documentation-workflow/</a>).  
</p>
<ul>
<li>GUI
</li>
<li>Programatic
</li>
</ul>


<p>  
I also think there are two types of users with different motivations and constraints:
</p>
<ul>
<li>1) Data Analysts
</li>
<li>2) Data Librarians
</li>
</ul>


</div>

</div>

<div id="outline-container-1-3" class="outline-4">
<h4 id="sec-1-3"><span class="section-number-4">1.3</span> Analysts can often trade-off completeness of documentation for speed</h4>
<div class="outline-text-4" id="text-1-3">

<p>In my view the Analysts group of users need a tool that will very rapidly document their data and workflow steps and can live with a bit less rigour in the quality of documentation.  Obviously this is not ideal but seems an inevitable trade-off needed to enable analysts to keep up the momentum of the data processing and modelling without getting distracted by tedious (and potentially unnecessary) data documentation tasks.
</p>
</div>

</div>

<div id="outline-container-1-4" class="outline-4">
<h4 id="sec-1-4"><span class="section-number-4">1.4</span> Librarians produce gold plated documentation and can take longer to produce this</h4>
<div class="outline-text-4" id="text-1-4">

<p>On the other hand the role of the Librarian group is to produce documentation to the best level possible (given time and resource constraints) the datasets and methodologies that lead to the creation of the datasets.  For that group Rigour will take precedence and there will be a trade-off in terms of the amount of time needed to produce the documentation.
</p>
</div>

</div>

<div id="outline-container-1-5" class="outline-4">
<h4 id="sec-1-5"><span class="section-number-4">1.5</span> An example</h4>
<div class="outline-text-4" id="text-1-5">

<p>As an example of the two different groups, an analyst working with weather data in Australia may want to specify that their variable "temperature" is the average of the daily maxima and minima, but might not need to specify that the observations were taken inside a Stevenson Screen, or even if they are in Celsius, Farenhiet or Kelvin.  They will be very keen to start the analysis to identify any associations between weather variables and the response variable they are investigating.   The data librarian on the other hand will be more likely to need to include this information so that the users of the temperature data do not mis-interpret it.
</p>
</div>

</div>

<div id="outline-container-1-6" class="outline-4">
<h4 id="sec-1-6"><span class="section-number-4">1.6</span> Embracing Inaccuracy and Incompleteness</h4>
<div class="outline-text-4" id="text-1-6">


<ul>
<li>I've been talking about this for a while got referred to this document by Ben Davies at the ANUSF
</li>
</ul>

<p>[http://thedailywtf.com/Articles/Documentation-Done-Right.aspx](<a href="http://thedailywtf.com/Articles/Documentation-Done-Right.aspx">http://thedailywtf.com/Articles/Documentation-Done-Right.aspx</a>)
</p><ul>
<li>It has this bit:
</li>
</ul>




<pre class="src src-R">  
   
Embracing Inaccuracy and Incompleteness 
    
The immediate answer to what&#8217;s the right way to do documentation is
clear: produce the least amount of documentation needed to facilitate
the most understanding, and be very explicit about which documentation
is to be maintained and which is to be archived (i.e., read-only and
left to rot).
</pre>


<ul>
<li>Roughly speaking, a full EML document produced by Morpho is a bit like a whole bunch of cruft that isnt needed and gets in the way (and is more confusing)
</li>
<li>Whereas a minimal version Im thinking of covers almost all the generic entries providing the "minimum amount of stuff to make it work right".
</li>
</ul>


</div>

</div>

<div id="outline-container-1-7" class="outline-4">
<h4 id="sec-1-7"><span class="section-number-4">1.7</span> Aim</h4>
<div class="outline-text-4" id="text-1-7">


<ul>
<li>This experiment aims to speed up the creation of a minimal "skeleton" of metadata to a level that both the groups above can be comfortable with AS A FIRST STEP.
</li>
<li>It is assumed that additional steps will then need to be taken to complete the documentation, but the automation of the first part of the process should shave off enough time to suit the purposes of both groups
</li>
<li>It is an imperative that the quick-start creation of the metadata does not end up costing the documentor more time later on down the track if they need to go back to many of the elements for additional editing.
</li>
</ul>





</div>

</div>

<div id="outline-container-1-8" class="outline-4">
<h4 id="sec-1-8"><span class="section-number-4">1.8</span> Step 1: load a simple example dataset</h4>
<div class="outline-text-4" id="text-1-8">

<p>I've been using a [fictitious dataset from a Statistics Methodology paper by Ritschard 2006](<a href="http://ivanhanigan.github.io/2013/10/test-data-for-classification-trees/">http://ivanhanigan.github.io/2013/10/test-data-for-classification-trees/</a>).  It will do as a first cut but when it comes to actually test this out it would be good to have something that would take a bit longer (so that the frustrations of using Morpho become very apparent).
</p>



<pre class="src src-R">  <span style="color: #586e75;">#### </span><span style="color: #586e75;">R Code:</span>
      <span style="color: #586e75;"># </span><span style="color: #586e75;">func</span>
      <span style="color: #268bd2; font-weight: bold;">require</span>(devtools)
      install_github(<span style="color: #2aa198;">"disentangle"</span>, <span style="color: #2aa198;">"ivanhanigan"</span>)
      <span style="color: #268bd2; font-weight: bold;">require</span>(disentangle)
      <span style="color: #586e75;"># </span><span style="color: #586e75;">load</span>
      fpath <span style="color: #268bd2; font-weight: bold;">&lt;-</span> system.file(
          file.path(<span style="color: #2aa198;">"extdata"</span>, <span style="color: #2aa198;">"civst_gend_sector_full.csv"</span>),
          package = <span style="color: #2aa198;">"disentangle"</span>
          )
      data_set <span style="color: #268bd2; font-weight: bold;">&lt;-</span> read.csv(fpath)
      summary(data_set)
      <span style="color: #586e75;"># </span><span style="color: #586e75;">store it in the current project workspace</span>
      write.csv(data_set, <span style="color: #2aa198;">"data/civst_gend_sector_full.csv"</span>, row.names = F)
      



<span style="color: #586e75;">## </span><span style="color: #586e75;">| divorced/widowed: 33 | female:132 | primary  :116 | Min.   : 128.9 |</span>
<span style="color: #586e75;">## </span><span style="color: #586e75;">| married         :120 | male  :141 | secondary: 99 | 1st Qu.: 768.3 |</span>
<span style="color: #586e75;">## </span><span style="color: #586e75;">| single          :120 | nil        | tertiary : 58 | Median : 922.8 |</span>
<span style="color: #586e75;">## </span><span style="color: #586e75;">| nil                  | nil        | nil           | Mean   : 908.4 |</span>
<span style="color: #586e75;">## </span><span style="color: #586e75;">| nil                  | nil        | nil           | 3rd Qu.:1079.1 |</span>
<span style="color: #586e75;">## </span><span style="color: #586e75;">| nil                  | nil        | nil           | Max.   :1479.4 |</span>

</pre>




</div>

</div>

<div id="outline-container-1-9" class="outline-4">
<h4 id="sec-1-9"><span class="section-number-4">1.9</span> Step 2 create a function to deliver the minimal metadata object</h4>
<div class="outline-text-4" id="text-1-9">

<ul>
<li>the package REML will create a EML metadata document quite easily
</li>
<li>I will assume that a lot of the data elements are self explanatory and take column names and factor levels as the descriptions
</li>
</ul>


</div>

</div>

<div id="outline-container-1-10" class="outline-4">
<h4 id="sec-1-10"><span class="section-number-4">1.10</span> reml<sub>boilerplate</sub>-code</h4>
<div class="outline-text-4" id="text-1-10">




<pre class="src src-R"><span style="color: #586e75;">################################################################</span>
<span style="color: #586e75;"># </span><span style="color: #586e75;">name:reml_boilerplate</span>
 
<span style="color: #586e75;"># </span><span style="color: #586e75;">func</span>
<span style="color: #859900; font-weight: bold;">if</span>(!<span style="color: #268bd2; font-weight: bold;">require</span>(reml)) {
  <span style="color: #268bd2; font-weight: bold;">require</span>(devtools)
  install_github(<span style="color: #2aa198;">"reml"</span>, <span style="color: #2aa198;">"ropensci"</span>)
  } 
<span style="color: #268bd2; font-weight: bold;">require</span>(reml)

<span style="color: #268bd2;">reml_boilerplate</span> <span style="color: #268bd2; font-weight: bold;">&lt;-</span> <span style="color: #859900; font-weight: bold;">function</span>(data_set, created_by = <span style="color: #2aa198;">"Ivan Hanigan &lt;<a href="mailto:ivanhanigan&#64;gmail.com">ivanhanigan&#64;gmail.com</a>&gt;"</span>, data_dir = getwd(), titl = <span style="color: #b58900;">NA</span>, desc = <span style="color: #2aa198;">""</span>)
{

  <span style="color: #586e75;"># </span><span style="color: #586e75;">essential</span>
  <span style="color: #859900; font-weight: bold;">if</span>(is.na(titl)) <span style="color: #859900; font-weight: bold;">stop</span>(print(<span style="color: #2aa198;">"must specify title"</span>))
  <span style="color: #586e75;"># </span><span style="color: #586e75;">we can get the col names easily</span>
  col_defs <span style="color: #268bd2; font-weight: bold;">&lt;-</span> names(data_set)
  <span style="color: #586e75;"># </span><span style="color: #586e75;">next create a list from the data</span>
  unit_defs <span style="color: #268bd2; font-weight: bold;">&lt;-</span> list()
  <span style="color: #859900; font-weight: bold;">for</span>(i <span style="color: #859900; font-weight: bold;">in</span> 1:ncol(data_set))
    {
      <span style="color: #586e75;"># </span><span style="color: #586e75;">i = 4</span>
      <span style="color: #859900; font-weight: bold;">if</span>(is.numeric(data_set[,i])){
        unit_defs[[i]] <span style="color: #268bd2; font-weight: bold;">&lt;-</span> <span style="color: #2aa198;">"numeric"</span>
      } <span style="color: #859900; font-weight: bold;">else</span> {
        unit_defs[[i]] <span style="color: #268bd2; font-weight: bold;">&lt;-</span> names(table(data_set[,i]))          
      }
    }
  <span style="color: #586e75;"># </span><span style="color: #586e75;">unit_defs</span>
  
  ds <span style="color: #268bd2; font-weight: bold;">&lt;-</span> data.set(data_set,
                 col.defs = col_defs,
                 unit.defs = unit_defs
                 )
  <span style="color: #586e75;">#</span><span style="color: #586e75;">str(ds)</span>

  metadata  <span style="color: #268bd2; font-weight: bold;">&lt;-</span> metadata(ds)
  <span style="color: #586e75;"># </span><span style="color: #586e75;">needs names</span>
  <span style="color: #859900; font-weight: bold;">for</span>(i <span style="color: #859900; font-weight: bold;">in</span> 1:ncol(data_set))
    {
      <span style="color: #586e75;"># </span><span style="color: #586e75;">i = 4</span>
      <span style="color: #859900; font-weight: bold;">if</span>(is.numeric(data_set[,i])){
        names(metadata[[i]][[3]]) <span style="color: #268bd2; font-weight: bold;">&lt;-</span> <span style="color: #2aa198;">"number"</span>
      } <span style="color: #859900; font-weight: bold;">else</span> {
        names(metadata[[i]][[3]]) <span style="color: #268bd2; font-weight: bold;">&lt;-</span> metadata[[i]][[3]]
      }
    }
  <span style="color: #586e75;"># </span><span style="color: #586e75;">metadata</span>
  oldwd <span style="color: #268bd2; font-weight: bold;">&lt;-</span> getwd()
  setwd(data_dir)
  eml_write(data_set, metadata,
            title = titl,  
            description = desc,
            creator = created_by
            )
  setwd(oldwd)
  sprintf(<span style="color: #2aa198;">"your metadata has been created in the '%s' directory"</span>, data_dir)
  }
</pre>

</div>

</div>

<div id="outline-container-1-11" class="outline-4">
<h4 id="sec-1-11"><span class="section-number-4">1.11</span> reml<sub>boilerplate</sub>-test-code</h4>
<div class="outline-text-4" id="text-1-11">




<pre class="src src-R"><span style="color: #586e75;">################################################################</span>
<span style="color: #586e75;"># </span><span style="color: #586e75;">name:reml_boilerplate-test</span>

analyte <span style="color: #268bd2; font-weight: bold;">&lt;-</span> read.csv(<span style="color: #2aa198;">"data/civst_gend_sector_full.csv"</span>)
reml_boilerplate(
  data_set = analyte,
  created_by = <span style="color: #2aa198;">"Ivan Hanigan &lt;<a href="mailto:ivanhanigan&#64;gmail.com">ivanhanigan&#64;gmail.com</a>&gt;"</span>,
  data_dir = <span style="color: #2aa198;">"data"</span>,
  titl = <span style="color: #2aa198;">"civst_gend_sector_full"</span>,
  desc = <span style="color: #2aa198;">"An example, fictional dataset"</span>
  )

dir(<span style="color: #2aa198;">"data"</span>)
</pre>

</div>

</div>

<div id="outline-container-1-12" class="outline-4">
<h4 id="sec-1-12"><span class="section-number-4">1.12</span> Results: This loads into Morpho with some errors</h4>
<div class="outline-text-4" id="text-1-12">

<ul>
<li>Notably unable to import the data file
</li>
</ul>


<p>
<img src="/images/morpho-reml-boilerplate.png" alt = "morpho-reml-boilerplate.png">
</p>
<ul>
<li>Also "the saved document is not valid for some reason"
</li>
</ul>


<p>
<img src="/images/morpho-reml-boilerplate2.png" alt = "morpho-reml-boilerplate2.png">
</p></div>

</div>

<div id="outline-container-1-13" class="outline-4">
<h4 id="sec-1-13"><span class="section-number-4">1.13</span> Conclusions</h4>
<div class="outline-text-4" id="text-1-13">

<ul>
<li>This needs testing
</li>
<li>A real deal breaker is if the EML is not valid 
</li>
<li>In some cases not having the data table included will be a deal breaker (ie KNB repositories designed for downloading complete data packs
</li>
<li>A definite failure would be that even if it is quicker to get started if it takes a long time and is difficult to fix up it might increase the risk of misunderstandings.
</li>
</ul>


</div>
</div>
</div>
</div>


<p></body>
</html></p>

      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/data documentation" title="data documentation" rel="category tag">data documentation</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2013/10/morpho-and-reml-streamline-the-process-of-metadata-entry/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2013-10-29 00:00:00 +1100">29 Oct 2013</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>


<div class="pagination">
  <span class="previous">
    
      
      <a href="/page17/" title="Previous Page">&laquo; Previous</a>
      
    
  </span>
  <span class="next">
    
    <a href="/page19/" title="Next Page">Next &raquo;</a>
    
  </span>
</div>
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=SChamberlain"></script>

        </div>
        <div id="sidebar">
          <div id="carrington-subscribe" class="widget">
            <h2 class="widget-title">Subscribe</h2>
            <a class="feed alignright" title="RSS 2.0 feed for posts" rel="alternate" href="http://feeds.feedburner.com/Disentanglethings">
              <img src="/images/rss-button.gif" alt="latest posts" title="latest posts">
            </a>
          </div>
          <div id="carrington-about" class="widget">
            <div class="about">
              <h2 class="widget-title">About</h2>
              <p>I am a PhD Student at the Australian National University.</p>
              <a class="more" href="/about.html">more â†’</a>

            </div>
          </div>
<div class="sidebar">
  <div class="logos">
  
  <ul>
          
      <!-- Add in logos here -->
      <a href="http://scholar.google.com/citations?user=cGN1P0wAAAAJ&hl=en"><img src="/images/GSIcon.jpg" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="http://orcid.org/0000-0002-6360-6793"><img src="/images/ORCID.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="http://github.com/ivanhanigan"><img src="/images/github.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="mailto:ivan.hanigan@gmail.com"><img src="/images/gmail.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="https://twitter.com/ivanhanigan"><img src="/images/twitter.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="http://www.linkedin.com/profile/view?id=AAMAAA-0wtwBnL35hDkq1UdK6vesju0LRODIVk0&trk=hp-identity-name"><img src="/images/linkedin.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
    
  </ul>
   
  </div>
</div>
          <!--
          	<p>
              <a href="http://ropensci.org/">
                <img src="/images/ropensci.png">
              </a>
        	</p>
			-->
			<!--
          <div id="carrington-link" class="widget">
          	<a href="http://ropensci.org/">
            <img src="/images/ropensci.png">
          </div>
          	-->
          
          <div id="primary-sidebar">
            <div class="widget">
              <h2 class="widget-title">Recent Entries</h2>
              <ul>
                
                <li>
                  <a href="/2015/10/open-notebook-blogging-vs-twitter-or-can-i-do-both/" title="Open Notebook Blogging Vs Twitter? Or Can I Do Both?" rel="bookmark">Open Notebook Blogging Vs Twitter? Or Can I Do Both?</a>
                </li>
                
                <li>
                  <a href="/2015/10/complexity-of-graphs-obfuscates-but-visual-grouping-helps-disentangle-things/" title="Complexity of Graphs Obfuscates, but Visual Grouping Helps Disentangle Things" rel="bookmark">Complexity of Graphs Obfuscates, but Visual Grouping Helps Disentangle Things</a>
                </li>
                
                <li>
                  <a href="/2015/10/research-protocol-for-manitoba-centre-for-health-policy/" title="Research Protocol For Manitoba Centre For Health Policy" rel="bookmark">Research Protocol For Manitoba Centre For Health Policy</a>
                </li>
                
                <li>
                  <a href="/2015/10/reproducible-research-pipelines-in-epidemiology/" title="Reproducible Research Pipelines In Epidemiology" rel="bookmark">Reproducible Research Pipelines In Epidemiology</a>
                </li>
                
                <li>
                  <a href="/2015/09/the-best-thing-about-reproducibility-is-not-reproducibility-but-transparency-and-rigour/" title="The Best Thing About Reproducibility Is Not Reproducibility, It Is Transparency And Rigour" rel="bookmark">The Best Thing About Reproducibility Is Not Reproducibility, It Is Transparency And Rigour</a>
                </li>
                
              </ul>
              <h2 class="widget-title">Categories</h2>
              <ul>
<!-- <li> -->
<!--               <a class="workflow" href="/categories/workflow.html">workflow</a> -->
<!-- </li> -->
                
                <li><a href="/categories/overview">overview (7)</a></li>
                
                <li><a href="/categories/research methods">research methods (43)</a></li>
                
                <li><a href="/categories/disentangle things">disentangle things (4)</a></li>
                
                <li><a href="/categories/spatial">spatial (6)</a></li>
                
                <li><a href="/categories/extreme weather events">extreme weather events (11)</a></li>
                
                <li><a href="/categories/spatial dependence">spatial dependence (9)</a></li>
                
                <li><a href="/categories/data documentation">data documentation (32)</a></li>
                
                <li><a href="/categories/cloud building">cloud building (2)</a></li>
                
                <li><a href="/categories/disentangle">disentangle (19)</a></li>
                
                <li><a href="/categories/project management">project management (3)</a></li>
                
                <li><a href="/categories/e-collaboration">e-collaboration (1)</a></li>
                
                <li><a href="/categories/ecosocial tipping points">ecosocial tipping points (2)</a></li>
                
                <li><a href="/categories/morpho">morpho (1)</a></li>
                
                <li><a href="/categories/writing">writing (1)</a></li>
                
                <li><a href="/categories/reproducible research reports">reproducible research reports (3)</a></li>
                
                <li><a href="/categories/data management">data management (2)</a></li>
                
              </ul>
              <h2 class="widget-title">Entries grouped by Tags</h2>
              <ul>
                
                <li><a href="/tag/morpho">morpho (15)</a></li>
                
                <li><a href="/tag/project management">project management (3)</a></li>
                
                <li><a href="/tag/Data Management System">Data Management System (3)</a></li>
                
                <li><a href="/tag/R-eml">R-eml (3)</a></li>
                
                <li><a href="/tag/bugs">bugs (1)</a></li>
                
                <li><a href="/tag/software">software (3)</a></li>
                
                <li><a href="/tag/spatial">spatial (1)</a></li>
                
                <li><a href="/tag/diagrams">diagrams (3)</a></li>
                
                <li><a href="/tag/blogging">blogging (2)</a></li>
                
                <li><a href="/tag/metadata">metadata (1)</a></li>
                
                <li><a href="/tag/R">R (1)</a></li>
                
              <div class="clear"></div>
              </ul>
            </div>
          </div>
          <!-- <div id="secondary-sidebar"> -->
          <!--   <div class="widget"> -->
          <!--     <h2 class="widget-title">Tags</h2> -->
          <!--     <ul> -->
          <!--        -->
          <!--       <li><a href="/tag/morpho">morpho (15)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/project management">project management (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/Data Management System">Data Management System (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/R-eml">R-eml (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/bugs">bugs (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/software">software (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/spatial">spatial (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/diagrams">diagrams (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/blogging">blogging (2)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/metadata">metadata (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/R">R (1)</a></li> -->
          <!--        -->
          <!--     <div class="clear"></div> -->
          <!--     </ul> -->
          <!--   </div> -->
            <!--
            <div class="widget">
              <h2 class="widget-title">Archives</h2>
              <ul>
                
              </ul>
              <div class="clear"></div>
            </div>
            -->
          </div>
        </div>
      </div>
    </div>
    <div id="footer" class="section">
      <div class="wrapper">
        <a id="generator-link">
          Banner Artwork by Cindy Hales. Site powered by
          <a href="https://github.com/mojombo/jekyll" rel="generator">Jekyll</a>
          with
          <a href="http://carringtontheme.com" title="Carrington theme for WordPress">Carrington</a>
          theme.
      </div>
      <div id="developer-link">
      </div>
    </div>
    <!--
	<a href="http://github.com/SChamberlain"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://assets2.github.com/img/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf?repo=&url=http%3A%2F%2Fs3.amazonaws.com%2Fgithub%2Fribbons%2Fforkme_right_red_aa0000.png&path=" alt="Fork me on GitHub"></a>
	-->
    <script type="text/javascript">
      var disqus_shortname = 'disentanglethings';

      (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
    </script>
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-28059658-1");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </body>
</html>
