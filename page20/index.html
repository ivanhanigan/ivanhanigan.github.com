<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Ivan Hanigan - Disentangle Things</title>
    <meta name="author" content="Ivan Hanigan" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/screen.css">
    <link href="http://feeds.feedburner.com/Disentanglethings" rel="alternate" title="RSS" type="application/rss+xml" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.github_v2.js"></script>
  </head>

  <body>


    <div id="header" class="section">
      <div class="wrapper">
        <strong id="blog-title">
          <a href="/" rel="home">Disentangle Things by Ivan Hanigan</a>
        </strong>
        <p id="blog-description"></p>
        <div id="navigation">
          <ul class="nav clearfix">
            <li class="first-child"><a href="/research.html">About My Notebook</a></li>
            <li> <a href="/blog.html">Entries</a></li> 

            <li><a href="/about.html">About Me</a></li>
            <li><a href="/publications.html">Journal Publications</a></li>
            <li><a href="/projects.html">Software</a></li>
            <li><a href="/projects.html">Data</a></li>
            <li><a href="/cv.html">My CV</a></li>
            <li><a href="http://lmgtfy.com/?q=site%3Aivanhanigan.github.io">Search this Site</a></li> 
            <!--<li><a href="/donors.html">Donors</a></li>-->
          </ul>
        </div>
      </div>
    </div>
    <div id="main" class="section">
      <div class="wrapper">
        <div id="content">
          <h2>Welcome to my Open Notebook</h2>

<p>This is an Open Notebook with <a href="http://onsclaims.wikispaces.com/">Selected Content - Delayed</a>. Find out more <a href="/research.html">Here</a>.</p>

<p>  <img src="/images/ONS-SCD.png" alt="ONS-SCD.png" /></p>

          <!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
  <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
  <a class="addthis_button_tweet"></a>
  <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
  <a class="addthis_counter addthis_pill_style"></a>
</div>
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=SChamberlain"></script>
<!-- AddThis Button END -->

  <div class="full">
    <h1 class="entry-title">
      <a href="/2013/10/spatial-lag-and-timeseries-model-with-nmmaps/" title="spatial-lag-and-timeseries-model-with-nmmaps" rel="bookmark">spatial-lag-and-timeseries-model-with-nmmaps</a>
    </h1>
    <div class="entry-content full-content">
      <ul>
<li>Today I chatted with Phil Kokic at CSIRO Mathematics, Informatics and Statistics about the way the spatially lagged neighbours variable absorbs any residual spatial correlation in the errors</li>
<li>We agreed that this is a pretty minimal attempt, not as good as a spatial error model but pretty easy to implement</li>
<li>I've hacked together some very very ugly code to construct the lagged variable</li>
<li><a href="http://ivanhanigan.github.io/spatiotemporal-regression-models/#sec-3">http://ivanhanigan.github.io/spatiotemporal-regression-models/#sec-3</a></li>
<li>There may be errors, it's been a long day, but I won't have a chance to check back on this till next week so I thought I'd put it out there as is.</li>
</ul>


      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/spatial dependence" title="spatial dependence" rel="category tag">spatial dependence</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2013/10/spatial-lag-and-timeseries-model-with-nmmaps/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2013-10-28 00:00:00 +1100">28 Oct 2013</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full">
    <h1 class="entry-title">
      <a href="/2013/10/extract-weather-data-from-awap-grids/" title="Daintree Rainforest Observatory Climate Data from AWAP-GRIDS" rel="bookmark">Daintree Rainforest Observatory Climate Data from AWAP-GRIDS</a>
    </h1>
    <div class="entry-content full-content">
      <p><body></p>

<div id="preamble">

</div>




<div id="content">
<h1 class="title">AWAP GRIDS </h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Introduction and Methods</a>
<ul>
<li><a href="#sec-1-1">1.1 Authors</a></li>
<li><a href="#sec-1-2">1.2 Background</a></li>
<li><a href="#sec-1-3">1.3 Material and Methods</a></li>
</ul>
</li>
<li><a href="#sec-2">2 R-code-for-extraction</a></li>
<li><a href="#sec-3">3 Results</a></li>
<li><a href="#sec-4">4 R-code-for-comparison</a></li>
<li><a href="#sec-5">5 Discussion</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-3">
<h3 id="sec-1"><span class="section-number-3">1</span> Introduction and Methods</h3>
<div class="outline-text-3" id="text-1">


<p>
This is a work in progress.  It is a stub of an article I want to put together which shows how to use several online data repositories together as a showcase of the [Scientific Workflow and Integration Software for Health (SWISH) Climate Impact Assessments](<a href="https://github.com/swish-climate-impact-assessment">https://github.com/swish-climate-impact-assessment</a>) project.
</p>

</div>

<div id="outline-container-1-1" class="outline-4">
<h4 id="sec-1-1"><span class="section-number-4">1.1</span> Authors</h4>
<div class="outline-text-4" id="text-1-1">

<ul>
<li>Ivan Hanigan and [Markus Nolf](<a href="http://www.thinkoholic.com">http://www.thinkoholic.com</a>)
</li>
</ul>


</div>

</div>

<div id="outline-container-1-2" class="outline-4">
<h4 id="sec-1-2"><span class="section-number-4">1.2</span> Background</h4>
<div class="outline-text-4" id="text-1-2">


<ul>
<li>Markus Nolf offers this use case of the [SWISH EWEDB](<a href="http://swish-climate-impact-assessment.github.io/">http://swish-climate-impact-assessment.github.io/</a>)
</li>
<li>Markus is pulling together his  Daintree Rainforest Observatory (DRO) data into a manuscript for publication, and was looking for climate data from 2012 as well as long-term. 
</li>
<li>More specifically, the annual precipitation and mean annual temperature for both 2012 and the 30-year mean.
</li>
<li>The Australian Bureau of Meteorology has a nice rainfall dataset available at <a href="http://www.bom.gov.au/climate/data/">http://www.bom.gov.au/climate/data/</a> ("Cape Trib Store" weather station), but it seems like the temperature records are patchy.
</li>
<li>So it is advised to use the data the DRO collects its self
</li>
<li>You need to apply through the [ASN SuperSite data portal](<a href="http://www.tern-supersites.net.au/knb/">http://www.tern-supersites.net.au/knb/</a>) for access to the daily data for the DRO.
</li>
<li>Note the use of the DRO met data will need to be properly cited as it is harder to keep
</li>
</ul>

<p>an AWS station running in the tropics for years than it is to collect most other data. 
The citation information is provided when you make a request to access the data.
</p><ul>
<li>The long term mean used by most DRO researchers is from the BOM station as we only have a short record from the station itself.  The offset is around 1000mm.
</li>
<li>However what we want is mean annual temperatures but the BOM website seems to focus more on mean minimum and maximum temperatures.
</li>
</ul>


</div>

</div>

<div id="outline-container-1-3" class="outline-4">
<h4 id="sec-1-3"><span class="section-number-4">1.3</span> Material and Methods</h4>
<div class="outline-text-4" id="text-1-3">


<ul>
<li id="sec-1-3-1">Baseline Climate Data 2012, Far North Queensland Rainforest Supersite, Cape Tribulation Node<br/>

<ul>
<li>We can use the data portal too see [the data file in question](<a href="http://www.tern-supersites.net.au/knb/metacat/lloyd.238.13/html">http://www.tern-supersites.net.au/knb/metacat/lloyd.238.13/html</a>)
</li>
<li>Application for access is via email
</li>
</ul>


</li>
</ul>
<ul>
<li id="sec-1-3-2">Extract mean annual temperatures at the BOM website<br/>

<ul>
<li>SWISH uses BoM data a fair bit and aims to streamline access to BoM data for extreme weather event analysis (which require long term average climatology to provide the baseline that extremes are measured against).
</li>
<li>WRT to temperature most daily averages from BoM are calculated as average of maximum<sub>temperature</sub><sub>in</sub><sub>24</sub><sub>hours</sub><sub>after</sub><sub>9am</sub><sub>local</sub><sub>time</sub><sub>in</sub><sub>degrees</sub> and minimum<sub>temperature</sub><sub>in</sub><sub>24</sub><sub>hours</sub><sub>before</sub><sub>9am</sub><sub>local</sub><sub>time</sub><sub>in</sub><sub>degree</sub> (only couple of hundred AWS provide hourly data to get the proper mean of 24 obs).
</li>
<li>The Bureau of Meteorology has generated a range of gridded meteorological datasets for Australia as a contribution to the Australian Water Availability Project (AWAP). These include daily max and min temperature which you could use to generate daily averages, then calculate your long term averages from those?  
</li>
<li><a href="http://www.bom.gov.au/jsp/awap/">http://www.bom.gov.au/jsp/awap/</a>
</li>
<li>Documentation is at <a href="http://www.bom.gov.au/amm/docs/2009/jones.pdf">http://www.bom.gov.au/amm/docs/2009/jones.pdf</a>
</li>
</ul>


</li>
</ul>
<ul>
<li id="sec-1-3-3">A workflow to download and process the public BoM weather grids.<br/>
<div id="outline-container-1" class="outline-3">
<h3 id="sec-1"><span class="section-number-3">1</span> R-depends</h3>
<div class="outline-text-3" id="text-1">




<pre class="src src-R"><span style="color: #7f9f7f;"># </span><span style="color: #7f9f7f;">depends</span>
install.packages(c(<span style="color: #cc9393;">'raster'</span>, <span style="color: #cc9393;">'rgdal'</span>, <span style="color: #cc9393;">'plyr'</span>, <span style="color: #cc9393;">'RODBC'</span>, <span style="color: #cc9393;">'RCurl'</span>, <span style="color: #cc9393;">'XML'</span>, <span style="color: #cc9393;">'ggmap'</span>, <span style="color: #cc9393;">'maptools'</span>, <span style="color: #cc9393;">'spdep'</span>))

</pre>

</div>
</div>

<ul>
<li>This workflow uses the open source R software with some of our custom written packages:
</li>
</ul>



</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2"><span class="section-number-3">2</span> R-code-for-extraction</h3>
<div class="outline-text-3" id="text-2">




<pre class="src src-R"><span style="color: #93a1a1;">################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">name:r-code</span>



<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">aim daily weather for any point location from online BoM weather grids</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">depends on some github packages</span>
<span style="color: #268bd2; font-weight: bold;">require</span>(awaptools)
<span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">http://swish-climate-impact-assessment.github.io/tools/awaptools/awaptools-downloads.html</span>
<span style="color: #268bd2; font-weight: bold;">require</span>(swishdbtools)
<span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">http://swish-climate-impact-assessment.github.io/tools/swishdbtools/swishdbtools-downloads.html</span>
<span style="color: #268bd2; font-weight: bold;">require</span>(gisviz)
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">http://ivanhanigan.github.io/gisviz/</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">and this from CRAN</span>
<span style="color: #859900; font-weight: bold;">if</span>(!<span style="color: #268bd2; font-weight: bold;">require</span>(raster)) install.packages(<span style="color: #2aa198;">'raster'</span>); <span style="color: #268bd2; font-weight: bold;">require</span>(raster)

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">get weather data, beware that each grid is a couple of megabytes</span>
vars <span style="color: #268bd2; font-weight: bold;">&lt;-</span> c(<span style="color: #2aa198;">"maxave"</span>,<span style="color: #2aa198;">"minave"</span>,<span style="color: #2aa198;">"totals"</span>,<span style="color: #2aa198;">"vprph09"</span>,<span style="color: #2aa198;">"vprph15"</span>) <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">,"solarave") </span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">solar only available after 1990</span>
<span style="color: #859900; font-weight: bold;">for</span>(measure <span style="color: #859900; font-weight: bold;">in</span> vars)
{
  <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">measure &lt;- vars[1]</span>
  get_awap_data(start = <span style="color: #2aa198;">'1960-01-01'</span>,end = <span style="color: #2aa198;">'1960-01-02'</span>, measure)
}

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">get location</span>
locn <span style="color: #268bd2; font-weight: bold;">&lt;-</span> geocode(<span style="color: #2aa198;">"daintree rainforest"</span>)
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">this uses google maps API, better check this</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">lon       lat</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">1 145.4185 -16.17003</span>
<span style="color: #93a1a1;">## </span><span style="color: #93a1a1;">Treat data frame as spatial points</span>
epsg <span style="color: #268bd2; font-weight: bold;">&lt;-</span> make_EPSG()
shp <span style="color: #268bd2; font-weight: bold;">&lt;-</span> SpatialPointsDataFrame(cbind(locn$lon,locn$lat),locn,
                              proj4string=CRS(epsg$prj4[epsg$code %<span style="color: #859900; font-weight: bold;">in</span>% <span style="color: #2aa198;">'4283'</span>]))
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">now loop over grids and extract met data</span>
cfiles <span style="color: #268bd2; font-weight: bold;">&lt;-</span>  dir(pattern=<span style="color: #2aa198;">"grid$"</span>)

<span style="color: #859900; font-weight: bold;">for</span> (i <span style="color: #859900; font-weight: bold;">in</span> seq_len(length(cfiles))) {
  <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">i &lt;- 1 ## for stepping thru</span>
  gridname <span style="color: #268bd2; font-weight: bold;">&lt;-</span> cfiles[[i]]
  r <span style="color: #268bd2; font-weight: bold;">&lt;-</span> raster(gridname)
  <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">image(r) # plot to look at</span>
  e <span style="color: #268bd2; font-weight: bold;">&lt;-</span> extract(r, shp, df=T)
  <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">str(e) ## print for debugging</span>
  e1 <span style="color: #268bd2; font-weight: bold;">&lt;-</span> shp
  e1@data$values <span style="color: #268bd2; font-weight: bold;">&lt;-</span> e[,2]
  e1@data$gridname <span style="color: #268bd2; font-weight: bold;">&lt;-</span> gridname
  <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">write to to target file</span>
  write.table(e1@data,<span style="color: #2aa198;">"output.csv"</span>,
    col.names = i == 1, append = i&gt;1 , sep = <span style="color: #2aa198;">","</span>, row.names = <span style="color: #b58900;">FALSE</span>)
}

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">further work is required to format the column with the gridname to get out the date and weather paramaters.</span>
</pre>

</div>

</div>

<div id="outline-container-3" class="outline-3">
<h3 id="sec-3"><span class="section-number-3">3</span> Results</h3>
<div class="outline-text-3" id="text-3">

<ul>
<li id="sec-3-1">Results<br/>

<ul>
<li>Markus reports:
</li>
<li>"The R-script worked great once i had set a working directory that did not include spaces. (It may have been a different problem that got solved by changing the wd, but the important thing is it's running now.)"
</li>
<li>Markus downloaded 70+ GB of gridded weather data from the BoM website to his local computer
</li>
<li>Also note there is another set of gridded data available from the BOM, which contains pre-computed longterm mean temps, [ready to be extracted with the script](<a href="http://reg.bom.gov.au/jsp/ncc/climate_averages/temperature/index.jsp?maptype=6&amp;period=#maps">http://reg.bom.gov.au/jsp/ncc/climate_averages/temperature/index.jsp?maptype=6&amp;period=#maps</a>)
</li>
<li>"Using this file, I only needed to get the 2012 temp grids for a comparison of 2012 vs. 30-year data. I'm going to run the extraction of 1961-1990 data, just to be sure."
</li>
<li>"When we finished analysis of the long-term temperature from daily means found:
</li>
<li>While the official, pre-computed long-term mean (i.e. 30-year grid file, analysed with your script) was 22.29 °C for the DRO coordinates (145.4494, -16.1041), the new value from daily means (i.e. daily minave and maxave averaged) is 24.91 °C.
</li>
<li>We're not sure what causes this discrepancy, but thought we'd note that there is one.
</li>
<li>For the manuscript, we ended up using the means obtained via BOM's method* to compare 1961-1990 values to 2012, both computed with the above script.
</li>
<li>(* average of daily min/max temperature for each year, then averaged across the entire 30 year period)
</li>
</ul>


</li>
</ul>
<ul>
<li id="sec-3-2">Dataset discrepancy<br/>

<ul>
<li>Following up on the interesting a difference between the two BoM datasets. 
</li>
<li>One thing that might cause this might be if you are calculating the average of the annual averages ie sum(annavs)/30 or the average of all the daily averages as sum(dailyavs)/(30 * 365 or 366)?  the variance will differ by these methods.
</li>
<li>looks like the 30 year dataset is the former:
</li>
<li>"Average annual temperatures (maximum, minimum or mean) are calculated by adding daily temperature values each year, dividing by the number of days in that year to get an average for that particular year. The average values for each year in a specified period (1961 to 1990) are added together and the final value is calculated by dividing by the number of years in the period (30 years in this case)."
</li>
</ul>

<p>[metadata](<a href="http://reg.bom.gov.au/jsp/ncc/climate_averages/temperature/index.jsp?maptype=6&amp;period=#maps">http://reg.bom.gov.au/jsp/ncc/climate_averages/temperature/index.jsp?maptype=6&amp;period=#maps</a>)
</p><ul>
<li>Markus followed the BOM calculation method, and just compared it with two other approaches.
</li>
<li>average of all 21914 values
</li>
<li>average of yearly sum(min and max values per year)/(ndays*2)
</li>
<li>average of yearly sum(daily average)/ndays)
</li>
<li>where ndays = number of days per year.
</li>
<li>Differences between these methods show only in the 6th decimal place, far from 2.62 degrees.
</li>
</ul>



</li>
</ul>
</div>

</div>

<div id="outline-container-4" class="outline-3">
<h3 id="sec-4"><span class="section-number-3">4</span> R-code-for-comparison</h3>
<div class="outline-text-3" id="text-4">




<pre class="src src-R"><span style="color: #93a1a1;">################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">This is Markus' comparison script </span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">also see the formatted table csv, as well as the SWISH script's raw output csv</span>

setwd(<span style="color: #2aa198;">"E:\\markus\\ph.d\\aus-daintree\\data-analysis\\climate"</span>)
climate <span style="color: #268bd2; font-weight: bold;">&lt;-</span> read.csv(<span style="color: #2aa198;">"minmaxave-30year-daily.csv"</span>, sep=<span style="color: #2aa198;">","</span>, dec=<span style="color: #2aa198;">"."</span>)

climate$year <span style="color: #268bd2; font-weight: bold;">&lt;-</span> substr(climate$file,1,4)
climate$dailymean <span style="color: #268bd2; font-weight: bold;">&lt;-</span> (climate$maxave+climate$minave)/2
head(climate)


<span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">total average across all days and values</span>
annmean <span style="color: #268bd2; font-weight: bold;">&lt;-</span> mean(c(climate$maxave,climate$minave))
annmean


<span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">daily means averaged by year, then total average</span>
annmean1 <span style="color: #268bd2; font-weight: bold;">&lt;-</span> c(1,2)
<span style="color: #859900; font-weight: bold;">for</span>(i <span style="color: #859900; font-weight: bold;">in</span> 1:30) {
        annmean1[i] <span style="color: #268bd2; font-weight: bold;">&lt;-</span> mean(climate[climate$year==(i+1960),]$dailymean)
        <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">print(annmean1[i])</span>
}
annmean1
mean(annmean1)


<span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">mean of all values per year, then total average</span>
annmean2 <span style="color: #268bd2; font-weight: bold;">&lt;-</span> c(1,2)
<span style="color: #859900; font-weight: bold;">for</span>(i <span style="color: #859900; font-weight: bold;">in</span> 1:30) {
        tmpdata <span style="color: #268bd2; font-weight: bold;">&lt;-</span> climate[climate$year==(i+1960),]
        annmean2[i] <span style="color: #268bd2; font-weight: bold;">&lt;-</span> (sum(tmpdata$maxave) + sum(tmpdata$minave))/(length(tmpdata$maxave)+length(tmpdata$minave))
        <span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">print(annmean2[i])</span>
}
annmean2; mean(annmean2)


<span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">differences</span>
annmean - mean(annmean1)
annmean - mean(annmean2)
mean(annmean1) - mean(annmean2)


</pre>


</div>

</div>

<div id="outline-container-5" class="outline-3">
<h3 id="sec-5"><span class="section-number-3">5</span> Discussion</h3>
<div class="outline-text-3" id="text-5">


<ul>
<li>Principal findings: Very convenient automated extraction of location-based time series data for the precise period that is requested.
</li>
<li>Weaknesses (whole method, not your script): very long download time for daily grids (~11.000 grids = huge dataset, took several days in my case). Yearly grids would be beneficial (and I believe most others are also looking mainly for data on a yearly (or larger) scale).
</li>
</ul>


<ul>
<li id="sec-5-1">Conclusion<br/>

<ul>
<li>Take home message: Seems like a perfect case of "double-check the data using one and the same method".
</li>
</ul>


</li>
</ul>
</div>
</div>
</div>


<p></body>
</html></p>

      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/extreme weather events" title="extreme weather events" rel="category tag">extreme weather events</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2013/10/extract-weather-data-from-awap-grids/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2013-10-26 00:00:00 +1100">26 Oct 2013</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full">
    <h1 class="entry-title">
      <a href="/2013/10/document-first-ask-questions-later/" title="document-first-ask-questions-later" rel="bookmark">document-first-ask-questions-later</a>
    </h1>
    <div class="entry-content full-content">
      <p>This post is just a short note about something I'm thinking of calling "documentation-driven development".
It is based on the concept of <a href="http://en.wikipedia.org/wiki/Test-driven_development">"test-driven development"</a>, and more recently:</p>

<ul>
<li><a href="http://lamages.blogspot.in/2013/04/test-driven-analysis.html">"test-driven analysis"</a></li>
<li>or even <a href="http://simplystatistics.org/2013/09/05/implementing-evidence-based-data-analysis-treading-a-new-path-for-reproducible-research-part-3/">"Evidence-based Data Analysis"</a>).</li>
<li>It is also a kind of a critique on the paradigm suggested by the BCCVL statement on <a href="http://bccvl.org.au/blog/2013/08/20/just-in-time-metadata/">"Just-In-Time metadata"</a>.</li>
</ul>


<p>Anyway, it is a small thing but hopefully big things will grow.</p>

      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/research methods" title="research methods" rel="category tag">research methods</a>
      
      <a href="/categories/data documentation" title="data documentation" rel="category tag">data documentation</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2013/10/document-first-ask-questions-later/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2013-10-25 00:00:00 +1100">25 Oct 2013</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full">
    <h1 class="entry-title">
      <a href="/2013/10/challenger-logistic/" title="A Great Intro 2 Logistic Regression" rel="bookmark">A Great Intro 2 Logistic Regression</a>
    </h1>
    <div class="entry-content full-content">
      <p>This is a great example of logistic regression,  because it is pretty simple but covers good ground.  I got it from Peter Caley;s R tutorial workbook from Charles Darwin School of Environmental Research.</p>

<p>It is also a tragic example of the impact weather can have on health.<br/>
The colder it is the more likely the shuttle is to explode.</p>

<p>The problem was with the failure rate (and number of) O-rings that failed (n.fail) related to the temperature (temp).</p>

<h4>R Code:</h4>

<pre><code>#Load the data
#The following R code will construct the dataset
n.fail &lt;- c(2, 0, 0, 1, 0, 0, 1, 0, 0, 1, 2, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0)
temp &lt;- c(53, 66, 68, 70, 75, 78, 57, 67, 69, 70, 75, 79, 58, 67, 70, 72, 76, 81, 63, 67, 70, 73, 76)
# there were 6 o rings for each of 23 attempts
total &lt;- rep(6,23)
# probability of fail
p.fail &lt;- n.fail/total
# Response = resp column bind them together  
resp &lt;- cbind(n.fail, total-n.fail)

###########################################################################
# we can write text files easily once the data frame or matrix is in shape
data &lt;- as.data.frame(cbind(resp,temp))
names(data) &lt;- c('nfail','totalMinusNfail', 'temp')
# write.csv(data, 'learnR-logistic-data.csv', row.names=F)

###########################################################################
# and read it in again 
# data2 &lt;- read.csv('learnR-logistic-data.csv')

################################################################
# name:learnR-logistic
png('images/pfail.png')
plot(temp, p.fail, pch=16, xlim=c(40,100), ylim=c(0,0.4))
title('A plot of the proportion failed by temperature')
dev.off()
</code></pre>

<p></p>


<p><img src="/images/pfail.png" alt="pfail.png" /></p>

<h4>R Code:</h4>

<pre><code>###########################################################################
# newnode: linear
linear &lt;- glm(resp ~ 1 + temp, family=binomial(link=logit))
summary(linear)
linearoutput &lt;- summary(linear)
linearoutput$coeff

###########################################################################
# newnode: learnR-logistic
cf &lt;- linearoutput$coeff
signif(cf[which(row.names(cf) == 'temp'),'Estimate'],2)

###########################################################################
# newnode: learnR-logistic
# write.csv(linearoutput$coeff,"challengerOfails.csv")

###########################################################################
# newnode: learnR-logistic
 png('images/challengerLogistic.png')
 par(mfrow=c(2,2))
 plot(linear)
 dev.off()
</code></pre>

<p></p>


<p><img src="/images/challengerLogistic.png" alt="challengerLogistic.png" /></p>

<h4>R Code:</h4>

<pre><code>####################################################################
# newnode: learnR-logistic
dummy &lt;- data.frame(temp=seq(20,100,1))
pred.prob &lt;- predict.glm(linear, newdata=dummy, type="resp")
png('images/pfailfit.png')
plot(temp, p.fail, xlab="Launch Temperature (F)",
 ylab="Proportion Failing", pch=16, xlim=c(20,100), ylim=c(0,1.0))
lines(dummy$temp, pred.prob)
dev.off()
</code></pre>

<p></p>


<p><img src="/images/pfailfit.png" alt="pfailfit.png" /></p>

<h4>R Code:</h4>

<pre><code>####################################################################
resp &lt;- as.data.frame(resp)
resp$fail &lt;- ifelse(resp$n.fail &gt; 0, 1, 0)
resp$temp &lt;- temp

png('images/fail.png')
with(resp, plot(temp, fail, xlab="Launch Temperature (F)",ylab="Joint damage", pch=16, xlim=c(50,80), ylim=c(0,1.0))
     )
dev.off()
</code></pre>

<p></p>


<p><img src="/images/fail.png" alt="fail.png" /></p>

<h4>R Code:</h4>

<pre><code>chal.logit &lt;- glm(fail~temp,family=binomial, data = resp)
summary(chal.logit)$coeff

png('images/pfailfit2.png')
cx &lt;- c(50:80/1)
cyhat &lt;- coefficients(chal.logit)[c(1)] +
coefficients(chal.logit)[c(2)]*cx
cpihat &lt;- exp(cyhat)/(1+exp(cyhat))
with(resp,plot(temp,fail,xlab="Temperature",ylab="Damage",
main="Incidence of Booster Field Joint Damage vs. Temperature", xlim = c(50,80))
     )
lines(cx,cpihat)
dev.off()
</code></pre>

<p></p>


<p><img src="/images/pfailfit2.png" alt="pfailfit2.png" /></p>

      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/research methods" title="research methods" rel="category tag">research methods</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2013/10/challenger-logistic/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2013-10-18 00:00:00 +1100">18 Oct 2013</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full">
    <h1 class="entry-title">
      <a href="/2013/10/spatially-structured-time-series-with-nmmaps/" title="spatially-structured-time-series-with-nmmaps" rel="bookmark">spatially-structured-time-series-with-nmmaps</a>
    </h1>
    <div class="entry-content full-content">
      <p>I will use the NMMAPSlite datasets for a simple example of what I
describe as "Spatially Structured Timeseries" as opposed to
"Spatio-Temporal" which I think more explicitly includes spatial
structure in the model.  <a href="http://ivanhanigan.github.io/spatiotemporal-regression-models/">See This Report</a> for all the gory details.</p>

<h1>R Codes</h1>

<!-- <?xml version="1.0" encoding="utf-8"?> -->


<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" -->


<!--                "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> -->


<!-- <html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"> -->


<p><head>
<title>Spatiotemporal Regression Modelling</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="Spatiotemporal Regression Modelling"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2013-10-16T15:17+1100"/>
<meta name="author" content="Ivan Hanigan"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/></p>



<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>


<p></head>
<body></p>

<div id="preamble">

</div>




<div id="content">
<h1 class="title">Spatiotemporal Regression Modelling</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Core Model</a></li>
<li><a href="#sec-2">2 Core Model Plots</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-4">
<h4 id="sec-1"><span class="section-number-4">1</span> Core Model</h4>
<div class="outline-text-4" id="text-1">




<pre class="src src-R"><span style="color: #5F7F5F;">################################################################</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">name:core</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">func</span>
setwd(<span style="color: #CC9393;">"~/projects/spatiotemporal-regression-models/NMMAPS-example"</span>)
<span style="color: #BFEBBF; font-weight: bold;">require</span>(mgcv)
<span style="color: #BFEBBF; font-weight: bold;">require</span>(splines)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">load</span>
analyte <span style="color: #BFEBBF; font-weight: bold;">&lt;-</span> read.csv(<span style="color: #CC9393;">"analyte.csv"</span>)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">clean</span>
analyte$yy <span style="color: #BFEBBF; font-weight: bold;">&lt;-</span> substr(analyte$date,1,4)
numYears<span style="color: #BFEBBF; font-weight: bold;">&lt;-</span>length(names(table(analyte$yy)))
analyte$date <span style="color: #BFEBBF; font-weight: bold;">&lt;-</span> as.Date(analyte$date)
analyte$time <span style="color: #BFEBBF; font-weight: bold;">&lt;-</span> as.numeric(analyte$date)
analyte$agecat <span style="color: #BFEBBF; font-weight: bold;">&lt;-</span> factor(analyte$agecat,
                          levels = c(<span style="color: #CC9393;">"under65"</span>,
                              <span style="color: #CC9393;">"65to74"</span>, <span style="color: #CC9393;">"75p"</span>),
                          ordered = <span style="color: #7CB8BB;">TRUE</span>
                          )

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">do</span>
fit <span style="color: #BFEBBF; font-weight: bold;">&lt;-</span> gam(cvd ~ s(tmax) + s(dptp) +
           city + agecat +
           s(time, k= 7*numYears, fx=T) +
           offset(log(pop)),
           data = analyte, family = poisson
           )

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">plot of response functions</span>
png(<span style="color: #CC9393;">"images/nmmaps-eg-core.png"</span>, width = 1000, height = 750, res = 150)
par(mfrow=c(2,3))
plot(fit, all.terms = <span style="color: #7CB8BB;">TRUE</span>)
dev.off()


</pre>

</div>

</div>

<div id="outline-container-2" class="outline-4">
<h4 id="sec-2"><span class="section-number-4">2</span> Core Model Plots</h4>
<div class="outline-text-4" id="text-2">

<p><img src="/images/nmmaps-eg-core.png"  alt="/images/nmmaps-eg-core.png" />
</p></div>
</div>
</div>


<p></body>
</html></p>

      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/spatial dependence" title="spatial dependence" rel="category tag">spatial dependence</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2013/10/spatially-structured-time-series-with-nmmaps/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2013-10-16 00:00:00 +1100">16 Oct 2013</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>


<div class="pagination">
  <span class="previous">
    
      
      <a href="/page19/" title="Previous Page">&laquo; Previous</a>
      
    
  </span>
  <span class="next">
    
    <a href="/page21/" title="Next Page">Next &raquo;</a>
    
  </span>
</div>
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=SChamberlain"></script>

        </div>
        <div id="sidebar">
          <div id="carrington-subscribe" class="widget">
            <h2 class="widget-title">Subscribe</h2>
            <a class="feed alignright" title="RSS 2.0 feed for posts" rel="alternate" href="http://feeds.feedburner.com/Disentanglethings">
              <img src="/images/rss-button.gif" alt="latest posts" title="latest posts">
            </a>
          </div>
          <div id="carrington-about" class="widget">
            <div class="about">
              <h2 class="widget-title">About</h2>
              <p>I am a PhD Student at the Australian National University.</p>
              <a class="more" href="/about.html">more →</a>

            </div>
          </div>
<div class="sidebar">
  <div class="logos">
  
  <ul>
          
      <!-- Add in logos here -->
      <a href="http://scholar.google.com/citations?user=cGN1P0wAAAAJ&hl=en"><img src="/images/GSIcon.jpg" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="http://orcid.org/0000-0002-6360-6793"><img src="/images/ORCID.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="http://github.com/ivanhanigan"><img src="/images/github.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="mailto:ivan.hanigan@gmail.com"><img src="/images/gmail.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="https://twitter.com/ivanhanigan"><img src="/images/twitter.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="http://www.linkedin.com/profile/view?id=AAMAAA-0wtwBnL35hDkq1UdK6vesju0LRODIVk0&trk=hp-identity-name"><img src="/images/linkedin.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
    
  </ul>
   
  </div>
</div>
          <!--
          	<p>
              <a href="http://ropensci.org/">
                <img src="/images/ropensci.png">
              </a>
        	</p>
			-->
			<!--
          <div id="carrington-link" class="widget">
          	<a href="http://ropensci.org/">
            <img src="/images/ropensci.png">
          </div>
          	-->
          
          <div id="primary-sidebar">
            <div class="widget">
              <h2 class="widget-title">Recent Entries</h2>
              <ul>
                
                <li>
                  <a href="/2015/10/a-driver-script-to-set-up-a-data-analysis-pipeline/" title="A Driver Script To Set Up A Data Analysis Pipeline" rel="bookmark">A Driver Script To Set Up A Data Analysis Pipeline</a>
                </li>
                
                <li>
                  <a href="/2015/10/coming-to-grips-with-citations-in-reproducible-research-reports/" title="Coming To Grips With Citations In Reproducible Research Reports" rel="bookmark">Coming To Grips With Citations In Reproducible Research Reports</a>
                </li>
                
                <li>
                  <a href="/2015/10/a-quick-review-of-a-quick-guide-to-organizing-computational-biology-projects/" title="A quick review of a quick guide to organizing computational biology projects" rel="bookmark">A quick review of a quick guide to organizing computational biology projects</a>
                </li>
                
                <li>
                  <a href="/2015/10/naming-conventions-for-computer-files/" title="Naming Conventions For Computer Files" rel="bookmark">Naming Conventions For Computer Files</a>
                </li>
                
                <li>
                  <a href="/2015/10/open-notebook-blogging-vs-twitter-or-can-i-do-both/" title="Open Notebook Blogging Vs Twitter? Or Can I Do Both?" rel="bookmark">Open Notebook Blogging Vs Twitter? Or Can I Do Both?</a>
                </li>
                
              </ul>
              <h2 class="widget-title">Categories</h2>
              <ul>
<!-- <li> -->
<!--               <a class="workflow" href="/categories/workflow.html">workflow</a> -->
<!-- </li> -->
                
                <li><a href="/categories/overview">overview (7)</a></li>
                
                <li><a href="/categories/research methods">research methods (43)</a></li>
                
                <li><a href="/categories/disentangle things">disentangle things (4)</a></li>
                
                <li><a href="/categories/spatial">spatial (6)</a></li>
                
                <li><a href="/categories/extreme weather events">extreme weather events (11)</a></li>
                
                <li><a href="/categories/spatial dependence">spatial dependence (9)</a></li>
                
                <li><a href="/categories/data documentation">data documentation (32)</a></li>
                
                <li><a href="/categories/cloud building">cloud building (2)</a></li>
                
                <li><a href="/categories/disentangle">disentangle (23)</a></li>
                
                <li><a href="/categories/project management">project management (3)</a></li>
                
                <li><a href="/categories/e-collaboration">e-collaboration (1)</a></li>
                
                <li><a href="/categories/ecosocial tipping points">ecosocial tipping points (2)</a></li>
                
                <li><a href="/categories/morpho">morpho (1)</a></li>
                
                <li><a href="/categories/writing">writing (1)</a></li>
                
                <li><a href="/categories/reproducible research reports">reproducible research reports (2)</a></li>
                
                <li><a href="/categories/data management">data management (2)</a></li>
                
              </ul>
              <h2 class="widget-title">Entries grouped by Tags</h2>
              <ul>
                
                <li><a href="/tag/morpho">morpho (15)</a></li>
                
                <li><a href="/tag/project management">project management (3)</a></li>
                
                <li><a href="/tag/Data Management System">Data Management System (3)</a></li>
                
                <li><a href="/tag/R-eml">R-eml (3)</a></li>
                
                <li><a href="/tag/bugs">bugs (1)</a></li>
                
                <li><a href="/tag/software">software (3)</a></li>
                
                <li><a href="/tag/spatial">spatial (1)</a></li>
                
                <li><a href="/tag/diagrams">diagrams (3)</a></li>
                
                <li><a href="/tag/blogging">blogging (2)</a></li>
                
                <li><a href="/tag/metadata">metadata (1)</a></li>
                
                <li><a href="/tag/R">R (1)</a></li>
                
                <li><a href="/tag/Reproducible Research Reports">Reproducible Research Reports (2)</a></li>
                
                <li><a href="/tag/Data Management">Data Management (3)</a></li>
                
              <div class="clear"></div>
              </ul>
            </div>
          </div>
          <!-- <div id="secondary-sidebar"> -->
          <!--   <div class="widget"> -->
          <!--     <h2 class="widget-title">Tags</h2> -->
          <!--     <ul> -->
          <!--        -->
          <!--       <li><a href="/tag/morpho">morpho (15)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/project management">project management (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/Data Management System">Data Management System (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/R-eml">R-eml (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/bugs">bugs (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/software">software (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/spatial">spatial (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/diagrams">diagrams (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/blogging">blogging (2)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/metadata">metadata (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/R">R (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/Reproducible Research Reports">Reproducible Research Reports (2)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/Data Management">Data Management (3)</a></li> -->
          <!--        -->
          <!--     <div class="clear"></div> -->
          <!--     </ul> -->
          <!--   </div> -->
            <!--
            <div class="widget">
              <h2 class="widget-title">Archives</h2>
              <ul>
                
              </ul>
              <div class="clear"></div>
            </div>
            -->
          </div>
        </div>
      </div>
    </div>
    <div id="footer" class="section">
      <div class="wrapper">
        <a id="generator-link">
          Banner Artwork by Cindy Hales. Site powered by
          <a href="https://github.com/mojombo/jekyll" rel="generator">Jekyll</a>
          with
          <a href="http://carringtontheme.com" title="Carrington theme for WordPress">Carrington</a>
          theme.
      </div>
      <div id="developer-link">
      </div>
    </div>
    <!--
	<a href="http://github.com/SChamberlain"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://assets2.github.com/img/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf?repo=&url=http%3A%2F%2Fs3.amazonaws.com%2Fgithub%2Fribbons%2Fforkme_right_red_aa0000.png&path=" alt="Fork me on GitHub"></a>
	-->
    <script type="text/javascript">
      var disqus_shortname = 'disentanglethings';

      (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
    </script>
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-28059658-1");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </body>
</html>
