<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Ivan Hanigan - Disentangle Things</title>
    <meta name="author" content="Ivan Hanigan" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/screen.css">
    <link href="http://feeds.feedburner.com/Disentanglethings" rel="alternate" title="RSS" type="application/rss+xml" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.github_v2.js"></script>
  </head>

  <body>


    <div id="header" class="section">
      <div class="wrapper">
        <strong id="blog-title">
          <a href="/" rel="home">Disentangle Things by Ivan Hanigan</a>
        </strong>
        <p id="blog-description"></p>
        <div id="navigation">
          <ul class="nav clearfix">
            <li class="first-child"><a href="/research.html">About My Notebook</a></li>
            <li> <a href="/blog.html">Entries</a></li> 

            <li><a href="/about.html">About Me</a></li>
            <li><a href="/publications.html">Journal Publications</a></li>
            <li><a href="/projects.html">Software</a></li>
            <li><a href="/projects.html">Data</a></li>
            <li><a href="/cv.html">My CV</a></li>
            <li><a href="http://lmgtfy.com/?q=site%3Aivanhanigan.github.io">Search this Site</a></li> 
            <!--<li><a href="/donors.html">Donors</a></li>-->
          </ul>
        </div>
      </div>
    </div>
    <div id="main" class="section">
      <div class="wrapper">
        <div id="content">
          <h2>Welcome to my Open Notebook</h2>

<p>This is an Open Notebook with <a href="http://onsclaims.wikispaces.com/">Selected Content - Delayed</a>. Find out more <a href="/research.html">Here</a>.</p>

<p>  <img src="/images/ONS-SCD.png" alt="ONS-SCD.png" /></p>

          <!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
  <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
  <a class="addthis_button_tweet"></a>
  <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
  <a class="addthis_counter addthis_pill_style"></a>
</div>
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=SChamberlain"></script>
<!-- AddThis Button END -->

  <div class="full">
    <h1 class="entry-title">
      <a href="/2015/09/reproducible-research-and-managing-digital-assets/" title="Reproducible Research And Managing Digital Assets (1 of 3). Scott Long wrote a book and some great tutorial slides" rel="bookmark">Reproducible Research And Managing Digital Assets (1 of 3). Scott Long wrote a book and some great tutorial slides</a>
    </h1>
    <div class="entry-content full-content">
      <p>This will be a series of three posts that describe some key evidence based best practice methods that have helped me plan and organise files and folders for data analysis.  I have found these via books and on websites.</p>

<ul>
<li>Scott Long's Workflow for Data Analysis with Stata</li>
<li>Josh Reich's Least Commonly Fouled up Data analysis (LCFD) framework</li>
<li>John Myles White's ProjectTemplate</li>
</ul>


<h2>Toward evidence based best-practice data management systems</h2>

<p>It is important for open science to have effective management of digital assets across the different phases of the research pipeline.  The traditional research pipeline moves from steps of hypothesis and design, measured data, analytic data, computational results (for figures, tables and numerical results), and reports (text and formatted manuscript).  Reproducible research pipelines extend traditional research by encoding the steps in code from a computer ‘scripting’ language, and distributing the data and code with publications.</p>

<p>In this research pipeline context there are a large number of potential ways to manage digital assets (documents, data and code).  There are also many different motivating drivers that will affect the way that a scientist or group of scientists choose to manage their data and code.</p>

<p>To deal with in house data management issues before starting and during analysis/reporting is critical for reproducible research.<br/>
I argue that more effective research pipelines can be achieved if scientists adopt the 'convention over configuration' paradigm and adopt best-practice systems based on evidence.</p>

<h3>Long, S. (2015). Workflow for Reproducible Results.</h3>

<p>For ages I was aware of the book from the Stata statistical program publishers <a href="http://www.indiana.edu/~jslsoc/web_workflow/wf_home.htm">http://www.indiana.edu/~jslsoc/web_workflow/wf_home.htm</a>:</p>

<h4>Citation:</h4>

<pre><code>Long, J. S. (2008). The Workflow of Data Analysis: 
Principles and Practice. Stata publishing.
</code></pre>

<p></p>


<p>Recently I stumbled across more recent workshop slides and tutorial material which I will discuss briefly.</p>

<h4>Citation:</h4>

<pre><code>Long, S. (2015). Workflow for Reproducible Results. 
IV : Managing digital assets Workflow for Tools for your WF. 
</code></pre>

<p></p>


<p>Retrieved from <a href="http://txrdc.tamu.edu/documents/WFtxcrdc2014_4-digital.pdf">http://txrdc.tamu.edu/documents/WFtxcrdc2014_4-digital.pdf</a></p>

<p>Long suggests a lot of practical things to do, but I will just focus here on the recommended file and folder structure:</p>

<h4>Recommended project directory structure:</h4>

<pre><code>\ProjectAcronym
    \- History starting YYYY-MM-DD
    \- Hold then delete 
    \Admin
    \Documentation 
    \Posted
         \Paper 1
             \Correspondence 
             \Text
             \Analysis
    \PrePosted 
    \Resources 
    \Write 
    \Work
</code></pre>

<p></p>


<p></p>

<ul>
<li>In another workshop report Long provides a useful tool to automatically create this structure on windows</li>
<li>Long, S. (2012). Principles of Workflow in Data Analysis.
Retrieved from <a href="http://www.indiana.edu/~wim/docs/2012-long-slides.pdf">http://www.indiana.edu/~wim/docs/2012-long-slides.pdf</a></li>
<li>a bash version would be useful for linux and mac users, but also the R language can do this on all platforms with the <code>dir.create</code> command</li>
</ul>


<h4>Code: wfsetupsingle.bat</h4>

<pre><code># wfsetupsingle.bat 
REM workflow talk 2 \ wfsetupsingle.bat jsl 2009-07-12 
REM directory structure for single person.
FOR /F "tokens=2,3,4 delims=/- " %%a in ("%DATE%") do set CDATE=%%c-%%a-%%b 
md "- History starting \%cdate%" 
md "- Hold then delete " 
md "- Pre posted " 
md "- To clean" 
md "Documentation" 
md "Posted" 
md "Resources"
md "Text\- Versions\" 
md "Work\- To do"
</code></pre>

<h2>Critical reflections</h2>

<ul>
<li>This recommendation is very sensible, especially the suggestion of moving things through the pipeline as they evolve from things being worked on (Write/Work) to later phases when they have been polished to a point that they can be put down while preparations for distrubuting them are made (Preposted) and then once they are sent off into downstream publication phases (Posted) they are locked for ever in a archival state.</li>
<li>I am not particularly keen on the names that have been chosen (Resources, Write and Work are quite ambiguous terms).</li>
</ul>


      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/disentangle" title="disentangle" rel="category tag">disentangle</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2015/09/reproducible-research-and-managing-digital-assets/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2015-09-25 00:00:00 +1000">25 Sep 2015</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full">
    <h1 class="entry-title">
      <a href="/2015/09/organising-graph-nodes-and-edges-in-a-dataframe/" title="Organising Graph Nodes And Edges In A Dataframe" rel="bookmark">Organising Graph Nodes And Edges In A Dataframe</a>
    </h1>
    <div class="entry-content full-content">
      <p>I use the R package <code>DiagrammeR</code> for creating graphs (the formal kind, connecting nodes with edges)
- This package is great and I like how it interacts with the Graphviz program
- One thing that I like to do in planning and organising data analysis projects is to make graphs and lists of the methods steps, inputs and Outputs
- A simple way to organise these things is in a dataframe (table) with a column for each step (node) and two others for inputs and outputs (edges)
- In my utilities R package <code>github.com/ivanhanigan/disentangle</code> I have written functions that turn this table into a graphiviz DOT language script
- Recently I have needed to unpack the list for a more itemized view
- Both these functions are showcased below</p>

<h4>Code: newnode</h4>

<pre><code># First create some test data, each step is a collection of edges 
# with inputs or outputs simple comma seperated lists
dat &lt;- read.csv(textConnection('
cluster ,  step    , inputs                    , outputs                                , description                      
A  ,  siteIDs      , "GPS, helicopter"          , "spatial, site doco"                 , latitude and longitude of sites  
A  ,  weather      , BoM                       , exposures                              , weather data from BoM            
B  ,  trapped      , spatial                   , trapped_no                             , counts of species caught in trap 
B  ,  biomass      , spatial                   , biomass_g                              ,                                  
B  ,  correlations , "exposures,trapped_no,biomass_g" , report1                         , A study we published             
C  ,  paper1       , report1                   , "open access repository, data package" ,                                  
D  ,  biomass revision, new estimates          , biomass_g                              , this came late
'), stringsAsFactors = F, strip.white = T)    
str(dat)
# dat

# Now run the function and create a graph
nodes &lt;- newnode(
  indat = dat,
  names_col = "step",
  in_col = "inputs",
  out_col = "outputs",
  desc_col = "description",
  clusters_col = "cluster",
  nchar_to_snip = 40
  )  
sink("Transformations.dot")
cat(nodes)
sink()
#DiagrammeR::grViz("Transformations.dot")
system("dot -Tpng Transformations.dot -o Transformations.png")
browseURL("Transformations.png")
</code></pre>

<p></p>


<p></p>

<p>That creates this diagram</p>

<p><img src="/images/Transformations.png" alt="/images/Transformations.png" /></p>

<h2>Now to showcase the tool that itemizes this list of inputs and outputs</h2>

<ul>
<li>The original table has no capacity to add detail about each node as they are held as a list of inputs and outputs</li>
<li>To add detail for each we need to unpack each list and create a new table with one row per node</li>
<li>I decided to make this a long table with an identifier for each node about which step (edge) the node is an input or an output</li>
</ul>


<h4>Code: newnode_csv</h4>

<pre><code>nodes_graphy &lt;- newnode_csv(
  indat = dat,
  names_col = "step",
  in_col = "inputs",
  out_col = "outputs",
  clusters_col = 'cluster'
  ) 
# which creates this table
knitr::kable(nodes_graphy)
|cluster |name             |in_or_out |value                  |
|:-------|:----------------|:---------|:----------------------|
|A       |siteIDs          |input     |GPS                    |
|A       |siteIDs          |input     |helicopter             |
|A       |siteIDs          |output    |spatial                |
|A       |siteIDs          |output    |site doco              |
|A       |weather          |input     |BoM                    |
|A       |weather          |output    |exposures              |
|B       |trapped          |input     |spatial                |
|B       |trapped          |output    |trapped_no             |
|B       |biomass          |input     |spatial                |
|B       |biomass          |output    |biomass_g              |
|B       |correlations     |input     |exposures              |
|B       |correlations     |input     |trapped_no             |
|B       |correlations     |input     |biomass_g              |
|B       |correlations     |output    |report1                |
|C       |paper1           |input     |report1                |
|C       |paper1           |output    |open access repository |
|C       |paper1           |output    |data package           |
|D       |biomass revision |input     |new estimates          |
|D       |biomass revision |output    |biomass_g              |
</code></pre>

<p></p>


<p>This can now be useful for making a 'shopping list' of the data to aquire, transform, analyse or archive.</p>

      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/disentangle" title="disentangle" rel="category tag">disentangle</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2015/09/organising-graph-nodes-and-edges-in-a-dataframe/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2015-09-23 00:00:00 +1000">23 Sep 2015</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full">
    <h1 class="entry-title">
      <a href="/2015/09/open-notebook-science-jekyll-blogs-github-and-jerry-seinfelds-secret-to-productivity/" title="Open Notebook Science, Jekyll Blogs, Github and Jerry Seinfeld's Secret to Productivity" rel="bookmark">Open Notebook Science, Jekyll Blogs, Github and Jerry Seinfeld's Secret to Productivity</a>
    </h1>
    <div class="entry-content full-content">
      <p>The other day I reported that I've implemented a new open science task management regime <a href="http://ivanhanigan.github.io/2015/09/task-management-like-an-open-science-hacker/">http://ivanhanigan.github.io/2015/09/task-management-like-an-open-science-hacker/</a>.</p>

<p>This was instigated by my renewed enthusiasm for open science after a few high profile papers have come out in the last few months imploring scientists to take action on shonky statistics and the "morass of poorly conducted data analyses, with errors ranging from trivial and strange to devastating" (Peng 2015) <a href="http://dx.doi.org/10.1111/j.1740-9713.2015.00827.x">http://dx.doi.org/10.1111/j.1740-9713.2015.00827.x</a>.</p>

<p>I believe that making ones electronic notebook open is one of the most obvious and easily achieved things to do toward that ambition.  I also think that keeping the TODO-list in the forefront of ones mind and continuously checking things off the list is a great boost for productivity and keeping on track.  This culminates in the advice to keep momentum by doing something toward the plan on a daily basis, no matter how trivial.  This is sometimes called Jerry Seinfeld's secret to productivity: Just keep at it. Don't break the streak. <a href="http://dirk.eddelbuettel.com/blog/2014/10/12/">http://dirk.eddelbuettel.com/blog/2014/10/12/</a>.</p>

<p>So what was holding me back from a really useful daily publication of my open notebook?  I showed last post how I manage tasks in Emac Orgmode (a task organiser and calendar/agenda rolled up with code execution for running R scripts etc).  I also write my blog posts in orgmode.</p>

<p>The only problem with that set up was that I was still using the code from Charlie Park <a href="http://charliepark.org/jekyll-with-plugins/">http://charliepark.org/jekyll-with-plugins/</a> which adds the inadequate commit description '<code>Latest build</code>' every time.  What I needed was a way to actually log a summary of work each day, so I can look back over the history and know I actually did something everyday and was not just gaming the system by committing random little non-work additions (I want to balance this by doing <em>some</em> work every day, but also take time off to read, exercise, socialize, and generally have fun).</p>

<p>So anyway, the point of this post is to describe my revision to Charlie Park's code for building a jekyll blog:</p>

<h4>Code: put in ~/.bash_profile</h4>

<pre><code>function bb() {
  cd ~/projects/ivanhanigan.github.com.raw &amp;&amp; jekyll b &amp;&amp; cp -r    
  ~/projects/ivanhanigan.github.com.raw/_site/* ~/projects/ivanhanigan.github.com &amp;&amp; 
  cd ~/projects/ivanhanigan.github.com &amp;&amp; git add . -A  &amp;&amp; 
  git commit -m "$*" &amp;&amp; 
  git push
}
</code></pre>

<p></p>


<ul>
<li>That bit about <code>$*</code> was a bit difficult for me to get working as this is the first time I have written a bash script in anger.  The alternative was to use <code>$1</code> and require the git commit message to be passed within quotes, which also makes sense but I did not do that.</li>
<li>I also needed to change the terminal settings so that it always loads the bash_profile</li>
</ul>


<h4>Bash terminal</h4>

<pre><code>Edit &gt; Profile preferences
Title and Command &gt; Run command as a login shell 
</code></pre>

<p></p>


<ul>
<li>And so now I just have to deposit a markdown blog post into the jekyll <code>_posts</code> folder and then</li>
</ul>


<h4>Bash</h4>

<pre><code>bb Add a meaningful commit message about todays progress
</code></pre>

<p></p>


<p>There you have it, a meaningful message regarding what I have been doing towards my scientific output every day.</p>

<p><img src="/images/seinfeld-streak-day9-1.png" alt="/images/seinfeld-streak-day9.png" /></p>

<p><img src="/images/seinfeld-streak-day9.png" alt="/images/seinfeld-streak-day9.png" /></p>

<h4>References</h4>

<pre><code>Peng, R. (2015). The reproducibility crisis in science: 
A statistical counterattack. Significance, 12(3), 30–32. 
doi:10.1111/j.1740-9713.2015.00827.x
</code></pre>

<p></p>


      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/disentangle" title="disentangle" rel="category tag">disentangle</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2015/09/open-notebook-science-jekyll-blogs-github-and-jerry-seinfelds-secret-to-productivity/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2015-09-22 00:00:00 +1000">22 Sep 2015</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full">
    <h1 class="entry-title">
      <a href="/2015/09/my-newnode-r-function-useful-for-causal-directed-acyclic-graphs/" title="My Newnode R Function Useful For Causal Directed Acyclic Graphs (DAGs)" rel="bookmark">My Newnode R Function Useful For Causal Directed Acyclic Graphs (DAGs)</a>
    </h1>
    <div class="entry-content full-content">
      <h1>Aims</h1>

<p>I have worked on a function that turns a <code>data.frame</code> into a graphviz code in the dot language, with some of my preferred settings.  I realised that it might be useful for causal directed acyclic graphs.</p>

<p>Causal diagrams are useful for conceptualising the pathways of cause and effect.  These diagrams are sometimes simplly informal pictures but have also been developed in a more formal way to be used in modelling.  These formal developments use concepts derived from the mathmatical abstraction of Graphs (fundamentally Graphs  are networks of linked 'nodes', with the links being termed 'edges').  Causal diagrams can either be constructed to depict two things: first are feedback loops (a vexatious property of complex systems that confounds modelling) while second are more simple chain-of-events type pathways which proceed from an upstream cause to a downstream effect in a single direction, without cycles, called 'Directed Acyclic Graphs or DAGs.  The loop diagrams are out of the scope of this present blog post because the DAGs are much more easily addressed by the tool that I am describing.</p>

<p>To begin I am going to build on this other guy's blog post on causal DAGs with R
  <a href="http://donlelek.github.io/2015/03/31/dags-with-r/">http://donlelek.github.io/2015/03/31/dags-with-r/</a>
I wanted to add an interface for building these.</p>

<p>Some background to the concepts that I use are provided in the references below.</p>

<h1>Materials and Methods</h1>

<p>The DiagrammeR package which has been integrated within R-Studio has made access to the graphing tool <code>graphviz</code> much easier than it used to be.  My function <code>causal_dag</code> (avaiable in my <code>disentangle</code> github package) essentially constructs the required <code>nodes</code> and <code>edges</code> for that package to use.  Optionally we can also include <code>labels</code> to indicate the direction of the effect.</p>

<p>To use the tool all you need to do is create a list of <code>edges</code> and their associated <code>inputs</code> nodes and <code>outputs</code> nodes (as a comma separated values string) shown in the picture below.</p>

<p><img src="/images/causal-ssheet.png" alt="causal-ssheet.png" /></p>

<h4>Code:</h4>

<pre><code># read in the sheet
library(disentangle)
library(stringr)
causes &lt;- readxl::read_excel("causal-ssheet.xlsx")
causes
nodes &lt;- newnode(causes, "edges", "inputs", "outputs")
cat(nodes)
# The result is a formated graph in the dot language with some of my
# preferred settings such as edges showing as 'records' and a spot to
# write a description or include literature about each process
</code></pre>

<p></p>


<ul>
<li>See the DOT code in the Appendix</li>
<li>to render the graph now DiagrammeR can use this text string R object to render this to SVG</li>
<li>I think it does not do PNG or PDF though so I still use graphviz and dot directly</li>
</ul>


<h4>Code:</h4>

<pre><code>grViz(nodes)

# But I also use graphviz directly to produce a publishable image in
# pdf or png
sink("reproduce-donlelek.dot")
cat(nodes)
sink()# If graphviz is installed and on linux call it with a shell command
#system("dot -Tpdf reproduce-donlelek.dot -o reproduce-donlelek.pdf")
system("dot -Tpng reproduce-donlelek.dot -o reproduce-donlelek.png")
</code></pre>

<p></p>


<h1>Results</h1>

<p>Here I have reproduced the work of donlelek</p>

<p><img src="/images/reproduce-donlelek.png" alt="reproduce-donlelek.png" /></p>

<h1>Future directions</h1>

<ul>
<li>I'd like to make the edges implicit, so that the spreadsheet keeps track of the information about the causal process, but the graph just shows the lines connecting the nodes</li>
<li>The edges are where the action is, so I need to add a direction of effect.  This would be in a <code>label</code> column and added in a [ label = 'abc' ] tag for each edge</li>
<li>the rankdir option is LR to make this go sideways, which seems more the norm for causal DAGs, left to right.</li>
</ul>


<h4>References</h4>

<pre><code>Greenland, S., Pearl, J., &amp; Robins, J. M. (1999). Causal diagrams for
epidemiologic research. Epidemiology (Cambridge, Mass.), 10(1),
37–48. doi:10.1097/00001648-199901000-00008

Reid, C. E., Snowden, J. M., Kontgis, C., &amp; Tager, I. B. (2012). The
role of ambient ozone in epidemiologic studies of heat-related
mortality. Environmental Health Perspectives, 120(12),
1627–30. doi:10.1289/ehp.1205251

Newell, B., &amp; Wasson, R. (2001). Social System vs Solar System: Why
Policy Makers Need History. In: Conflict and Cooperation related to
International Water Resources : Historical Perspectives. In World
Water (Vol. 2002).
</code></pre>

<p></p>


<h1>Appendix</h1>

<h4>Code:</h4>

<pre><code>#####################################################################
# The following output is automatically created by newnode()
# NOTE for some reason, to show on the blog, I had to replace all { braces with normal (
#####################################################################
digraph transformations (

"Metritis" -&gt; "Fertility effects"
"Cistic Ovarian Disease" -&gt; "Fertility effects"
"Age" -&gt; "Fertility effects"
"Fertility effects"  [ shape=record, label="(( ( Name | Description ) | ( Fertility effects |  ) ))"]
"Fertility effects" -&gt; "Fertility"


"Metritis" -&gt; "Cistic Ovarian effects"
"Retained Placenta" -&gt; "Cistic Ovarian effects"
"Age" -&gt; "Cistic Ovarian effects"
"Cistic Ovarian effects"  [ shape=record, label="(( ( Name | Description ) | ( Cistic Ovarian effects |  ) ))"]
"Cistic Ovarian effects" -&gt; "Cistic Ovarian Disease"


"Retained Placenta" -&gt; "Metritis effects"
"Metritis effects"  [ shape=record, label="(( ( Name | Description ) | ( Metritis effects |  ) ))"]
"Metritis effects" -&gt; "Metritis"


 "Age" -&gt; "Retained Placenta effects"
"Retained Placenta effects"  [ shape=record, label="(( ( Name | Description ) | ( Retained Placenta effects |  ) ))"]
"Retained Placenta effects" -&gt; "Retained Placenta"


 )
</code></pre>

      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/disentangle" title="disentangle" rel="category tag">disentangle</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2015/09/my-newnode-r-function-useful-for-causal-directed-acyclic-graphs/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2015-09-19 00:00:00 +1000">19 Sep 2015</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full">
    <h1 class="entry-title">
      <a href="/2015/09/if-you-dont-find-a-solution-in-r-keep-googling/" title="If You Don't Find A Solution In R, Keep Googling!" rel="bookmark">If You Don't Find A Solution In R, Keep Googling!</a>
    </h1>
    <div class="entry-content full-content">
      <p>I've learnt this lesson multiple times. It happens like this.  A solution is not immediately obvious in R so you might think of writing your own function.  Generally there is a solution you just did not google enough.
This time I was tricked a little because the GIS functions have been bad for a long time but getting better very rapidly recently.  A little while ago I had a very successful
outcome from using the <code>raster::extract</code> function on a large raster file
to get the attributes for a set of points.  I needed to do the same
thing but this time for a shapefile and points.  I looked at the
raster package and saw you can use the <code>raster::intersect</code> function
here, and it worked on the small sample data I tested with but failed
with the big dataset as it ran out of memory.  I assumed that R had not caught up with the GIS world yet and so I came up with this workaround below by splitting the points data layer into chunks.</p>

<p>I then got access to ArcMap and was wondering whether it could do it, and it DID!
So then I googled a bit and found the solution was simple:</p>

<h4>Code:</h4>

<pre><code>sp::over()
</code></pre>

<p></p>


<p>Here is my hack in case I ever need to pull out the bit that does the splitting up of the points file, or the tryCatch():</p>

<h4>Code:</h4>

<pre><code>big_pt_intersect &lt;- function(pts, ply, chunks = 100){
  idx &lt;- split(pts@data, 1:chunks)
  #str(idx)
  for(i in 1:length(idx)){
  #i = 1
  print(i)
    ids &lt;- idx[ [i] ][,1]
  #str(pts@data)
  qc &lt;- pts[pts@data[,1] %in% ids,]
  #str(qc)
  tryCatch(
    chunk &lt;-  raster::intersect(qc, ply), 
    error = function(err){print(err)})
  if(!exists('chunk_out')){

    chunk_out &lt;- chunk@data
  } else {
    chunk_out &lt;- rbind(chunk_out, chunk@data)
  }
  rm(chunk)

  }
  #str(chunk_out)
  return(chunk_out)
}
# NB warning about split length multiple is not fatal, just due to nonequal chunks 
# (ie the geocodes are 2009/100)
</code></pre>

<p></p>


      <div class="clear"></div>
    </div>
    <p class="alt-font tight">
      Posted in&nbsp;
      
      <a href="/categories/disentangle" title="disentangle" rel="category tag">disentangle</a>
      
    </p>
    <!--
	<p class="comments-link">
      <a href='/2015/09/if-you-dont-find-a-solution-in-r-keep-googling/#disqus_thread'>Comments</a>
    </p>
	-->
    <p class="by-line">
      <span class="date full-date">
        <abbr class="published" title="2015-09-17 00:00:00 +1000">17 Sep 2015</abbr>
      </span>
    </p>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>


<div class="pagination">
  <span class="previous">
    
      
      <a href="/page3/" title="Previous Page">&laquo; Previous</a>
      
    
  </span>
  <span class="next">
    
    <a href="/page5/" title="Next Page">Next &raquo;</a>
    
  </span>
</div>
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=SChamberlain"></script>

        </div>
        <div id="sidebar">
          <div id="carrington-subscribe" class="widget">
            <h2 class="widget-title">Subscribe</h2>
            <a class="feed alignright" title="RSS 2.0 feed for posts" rel="alternate" href="http://feeds.feedburner.com/Disentanglethings">
              <img src="/images/rss-button.gif" alt="latest posts" title="latest posts">
            </a>
          </div>
          <div id="carrington-about" class="widget">
            <div class="about">
              <h2 class="widget-title">About</h2>
              <p>I am a PhD Student at the Australian National University.</p>
              <a class="more" href="/about.html">more →</a>

            </div>
          </div>
<div class="sidebar">
  <div class="logos">
  
  <ul>
          
      <!-- Add in logos here -->
      <a href="http://scholar.google.com/citations?user=cGN1P0wAAAAJ&hl=en"><img src="/images/GSIcon.jpg" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="http://orcid.org/0000-0002-6360-6793"><img src="/images/ORCID.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="http://github.com/ivanhanigan"><img src="/images/github.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="mailto:ivan.hanigan@gmail.com"><img src="/images/gmail.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="https://twitter.com/ivanhanigan"><img src="/images/twitter.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
          
      <!-- Add in logos here -->
      <a href="http://www.linkedin.com/profile/view?id=AAMAAA-0wtwBnL35hDkq1UdK6vesju0LRODIVk0&trk=hp-identity-name"><img src="/images/linkedin.png" height=22px width=22px/></a>&nbsp;&nbsp;&nbsp;&nbsp; 
    
  </ul>
   
  </div>
</div>
          <!--
          	<p>
              <a href="http://ropensci.org/">
                <img src="/images/ropensci.png">
              </a>
        	</p>
			-->
			<!--
          <div id="carrington-link" class="widget">
          	<a href="http://ropensci.org/">
            <img src="/images/ropensci.png">
          </div>
          	-->
          
          <div id="primary-sidebar">
            <div class="widget">
              <h2 class="widget-title">Recent Entries</h2>
              <ul>
                
                <li>
                  <a href="/2015/10/reproducible-research-pipelines-improve-description-of-method-steps/" title="Reproducible research pipelines improve description of method steps" rel="bookmark">Reproducible research pipelines improve description of method steps</a>
                </li>
                
                <li>
                  <a href="/2015/10/how-to-effectively-implement-electronic-lab-notebooks-in-epidemiology/" title="How To Effectively Implement Electronic Lab Notebooks In Epidemiology" rel="bookmark">How To Effectively Implement Electronic Lab Notebooks In Epidemiology</a>
                </li>
                
                <li>
                  <a href="/2015/10/gis-issues-when-r-used-transforming-coordinate-systems/" title="GIS Issues when R is Used for Transforming Coordinate Systems" rel="bookmark">GIS Issues when R is Used for Transforming Coordinate Systems</a>
                </li>
                
                <li>
                  <a href="/2015/10/a-set-of-guidelines-for-exploratory-data-analysis-and-cleaning/" title="A Set Of Guidelines For Exploratory Data Analysis And Cleaning" rel="bookmark">A Set Of Guidelines For Exploratory Data Analysis And Cleaning</a>
                </li>
                
                <li>
                  <a href="/2015/10/a-driver-script-to-set-up-a-data-analysis-pipeline/" title="A Driver Script To Set Up A Data Analysis Pipeline" rel="bookmark">A Driver Script To Set Up A Data Analysis Pipeline</a>
                </li>
                
              </ul>
              <h2 class="widget-title">Categories</h2>
              <ul>
<!-- <li> -->
<!--               <a class="workflow" href="/categories/workflow.html">workflow</a> -->
<!-- </li> -->
                
                <li><a href="/categories/overview">overview (7)</a></li>
                
                <li><a href="/categories/research methods">research methods (43)</a></li>
                
                <li><a href="/categories/disentangle things">disentangle things (4)</a></li>
                
                <li><a href="/categories/spatial">spatial (7)</a></li>
                
                <li><a href="/categories/extreme weather events">extreme weather events (11)</a></li>
                
                <li><a href="/categories/spatial dependence">spatial dependence (9)</a></li>
                
                <li><a href="/categories/data documentation">data documentation (32)</a></li>
                
                <li><a href="/categories/cloud building">cloud building (2)</a></li>
                
                <li><a href="/categories/disentangle">disentangle (26)</a></li>
                
                <li><a href="/categories/project management">project management (3)</a></li>
                
                <li><a href="/categories/e-collaboration">e-collaboration (1)</a></li>
                
                <li><a href="/categories/ecosocial tipping points">ecosocial tipping points (2)</a></li>
                
                <li><a href="/categories/morpho">morpho (1)</a></li>
                
                <li><a href="/categories/writing">writing (1)</a></li>
                
                <li><a href="/categories/reproducible research reports">reproducible research reports (2)</a></li>
                
                <li><a href="/categories/data management">data management (2)</a></li>
                
                <li><a href="/categories/data operation">data operation (1)</a></li>
                
                <li><a href="/categories/workflow tools">workflow tools (2)</a></li>
                
              </ul>
              <h2 class="widget-title">Entries grouped by Tags</h2>
              <ul>
                
                <li><a href="/tag/morpho">morpho (15)</a></li>
                
                <li><a href="/tag/project management">project management (3)</a></li>
                
                <li><a href="/tag/Data Management System">Data Management System (3)</a></li>
                
                <li><a href="/tag/R-eml">R-eml (3)</a></li>
                
                <li><a href="/tag/bugs">bugs (1)</a></li>
                
                <li><a href="/tag/software">software (3)</a></li>
                
                <li><a href="/tag/spatial">spatial (1)</a></li>
                
                <li><a href="/tag/diagrams">diagrams (3)</a></li>
                
                <li><a href="/tag/blogging">blogging (2)</a></li>
                
                <li><a href="/tag/metadata">metadata (1)</a></li>
                
                <li><a href="/tag/R">R (1)</a></li>
                
                <li><a href="/tag/Reproducible Research Reports">Reproducible Research Reports (2)</a></li>
                
                <li><a href="/tag/Data Management">Data Management (3)</a></li>
                
                <li><a href="/tag/Exploratory Data Analysis">Exploratory Data Analysis (1)</a></li>
                
              <div class="clear"></div>
              </ul>
            </div>
          </div>
          <!-- <div id="secondary-sidebar"> -->
          <!--   <div class="widget"> -->
          <!--     <h2 class="widget-title">Tags</h2> -->
          <!--     <ul> -->
          <!--        -->
          <!--       <li><a href="/tag/morpho">morpho (15)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/project management">project management (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/Data Management System">Data Management System (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/R-eml">R-eml (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/bugs">bugs (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/software">software (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/spatial">spatial (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/diagrams">diagrams (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/blogging">blogging (2)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/metadata">metadata (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/R">R (1)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/Reproducible Research Reports">Reproducible Research Reports (2)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/Data Management">Data Management (3)</a></li> -->
          <!--        -->
          <!--       <li><a href="/tag/Exploratory Data Analysis">Exploratory Data Analysis (1)</a></li> -->
          <!--        -->
          <!--     <div class="clear"></div> -->
          <!--     </ul> -->
          <!--   </div> -->
            <!--
            <div class="widget">
              <h2 class="widget-title">Archives</h2>
              <ul>
                
              </ul>
              <div class="clear"></div>
            </div>
            -->
          </div>
        </div>
      </div>
    </div>
    <div id="footer" class="section">
      <div class="wrapper">
        <a id="generator-link">
          Banner Artwork by Cindy Hales. Site powered by
          <a href="https://github.com/mojombo/jekyll" rel="generator">Jekyll</a>
          with
          <a href="http://carringtontheme.com" title="Carrington theme for WordPress">Carrington</a>
          theme.
      </div>
      <div id="developer-link">
      </div>
    </div>
    <!--
	<a href="http://github.com/SChamberlain"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://assets2.github.com/img/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf?repo=&url=http%3A%2F%2Fs3.amazonaws.com%2Fgithub%2Fribbons%2Fforkme_right_red_aa0000.png&path=" alt="Fork me on GitHub"></a>
	-->
    <script type="text/javascript">
      var disqus_shortname = 'disentanglethings';

      (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
    </script>
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-28059658-1");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </body>
</html>
